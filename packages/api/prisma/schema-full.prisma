// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}


// ===== CORE MODELS =====

model Tenant {
  id        String   @id @default(cuid())
  name      String
  subdomain String   @unique
  domain    String?  @unique
  status    TenantStatus @default(ACTIVE)
  plan      TenantPlan   @default(STARTER)
  settings  Json
  defaultLanguage String           @default("en")
  supportedLanguages String[]      @default(["en"])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  users         User[]
  organizations Organization[]
  pages         Page[]
  templates     Template[]
  media         Media[]
  contentBlocks ContentBlock[]
  events        Event[]
  eventRSVPs    EventRSVP[]
  payments      Payment[]
  donations     Donation[]
  subscriptions Subscription[]
  notifications Notification[]
  apiKeys       ApiKey[]
  backups       Backup[]
  integrations  Integration[]
  webhookEvents WebhookEvent[]
  auditLogs     AuditLog[]
  
  // CMS relationships
  contentTypes    ContentType[]
  contents        Content[]
  categories      Category[]
  tags            Tag[]
  contentTemplates ContentTemplate[]
  
  // Event management relationships
  eventTicketTypes EventTicketType[]
  eventTickets    EventTicket[]
  eventSessions   EventSession[]
  eventSponsors   EventSponsor[]
  eventWaitlists  EventWaitlist[]
  eventReminders  EventReminder[]
  eventFeedback   EventFeedback[]
  
  // Member portal relationships
  memberApplications MemberApplication[]
  memberPoints    MemberPoints[]
  volunteerLogs   VolunteerLog[]
  memberBadges    MemberBadge[]
  
  // Internationalization relationships
  tenantLanguages TenantLanguage[]
  translationKeys TranslationKey[]
  contentTranslations ContentTranslation[]
  
  // Communication Hub relationships
  communicationChannels CommunicationChannel[]
  channelMembers ChannelMember[]
  messages Message[]
  messageThreads MessageThread[]
  messageReactions MessageReaction[]
  messageMentions MessageMention[]
  channelInvitations ChannelInvitation[]
  directMessages DirectMessage[]
  dmReactions DMReaction[]
  announcements Announcement[]
  announcementRecipients AnnouncementRecipient[]
  forums Forum[]
  forumCategories ForumCategory[]
  forumTopics ForumTopic[]
  forumPosts ForumPost[]
  forumModerators ForumModerator[]
  
  // Advanced Search relationships
  searchIndices SearchIndex[]
  searchQueries SearchQuery[]
  searchSuggestions SearchSuggestion[]
  savedSearches SavedSearch[]
  searchFacets SearchFacet[]
  searchResults SearchResult[]
  
  // Push Notification relationships
  pushDevices PushDevice[]
  pushNotifications PushNotification[]
  notificationTemplates NotificationTemplate[]
  notificationPreferences NotificationPreference[]
  notificationCampaigns NotificationCampaign[]
  notificationAnalytics NotificationAnalytics[]
  
  // Data Export/Import relationships
  dataExports DataExport[]
  dataImports DataImport[]
  dataTemplates DataTemplate[]
  dataSyncs DataSync[]
  dataBackups DataBackup[]
  
  // AI/ML Features relationships
  aiModels AIModel[]
  aiPredictions AIPrediction[]
  aiInsights AIInsight[]
  recommendationEngines RecommendationEngine[]
  chatSessions ChatSession[]
  contentAnalyses ContentAnalysis[]
  automationRules AutomationRule[]
  
  // Advanced Analytics relationships
  analyticsDashboards AnalyticsDashboard[]
  analyticsMetrics AnalyticsMetric[]
  analyticsQueries AnalyticsQuery[]
  analyticsAlerts AnalyticsAlert[]
  dataCubes DataCube[]
  cohortAnalyses CohortAnalysis[]
  funnelAnalyses FunnelAnalysis[]
  retentionAnalyses RetentionAnalysis[]
  segmentAnalyses SegmentAnalysis[]
  
  // Performance Monitoring relationships
  performanceMetrics PerformanceMetric[]
  performanceTraces PerformanceTrace[]
  performanceAlerts PerformanceAlert[]
  performanceAlertTriggers PerformanceAlertTrigger[]
  systemHealthChecks SystemHealthCheck[]
  performanceProfiles PerformanceProfile[]
  resourceUsages ResourceUsage[]
  performanceBenchmarks PerformanceBenchmark[]
  
  // Workflow Automation relationships
  workflows Workflow[]
  workflowSteps WorkflowStep[]
  workflowExecutions WorkflowExecution[]
  workflowStepExecutions WorkflowStepExecution[]
  workflowSchedules WorkflowSchedule[]
  workflowTemplates WorkflowTemplate[]
  workflowWebhooks WorkflowWebhook[]
  workflowVariables WorkflowVariable[]
  workflowLogs WorkflowLog[]
  
  // Advanced Security relationships
  securityPolicies SecurityPolicy[]
  securityViolations SecurityViolation[]
  securityScans SecurityScan[]
  securityIncidents SecurityIncident[]
  securityAlerts SecurityAlert[]
  securityAuditLogs SecurityAuditLog[]
  threatIntelligence ThreatIntelligence[]
  securityBaselines SecurityBaseline[]
  securityConfigurations SecurityConfiguration[]
  
  // Steps 46-55 relationships
  assets Asset[]
  assetMaintenance AssetMaintenance[]
  complianceFrameworks ComplianceFramework[]
  complianceAssessments ComplianceAssessment[]
  resources Resource[]
  resourceAllocations ResourceAllocation[]
  knowledgeArticles KnowledgeArticle[]
  articleFeedback ArticleFeedback[]
  supportTickets SupportTicket[]
  ticketMessages TicketMessage[]
  socialAccounts SocialAccount[]
  socialPosts SocialPost[]
  mobileDevices MobileDevice[]
  mobileSessions MobileSession[]
  ioTDevices IoTDevice[]
  ioTTelemetry IoTTelemetry[]
  blockchainTransactions BlockchainTransaction[]
  smartContracts SmartContract[]
  edgeNodes EdgeNode[]
  edgeWorkloads EdgeWorkload[]
  
  // Steps 56-65 relationships
  streamingChannels StreamingChannel[]
  streamingStreams Stream[]
  streamingRecordings StreamingRecording[]
  virtualEvents VirtualEvent[]
  eventAttendees EventAttendee[]
  arExperiences ARExperience[]
  arMarkers ARMarker[]
  arInteractions ARInteraction[]
  mlPipelines MLPipeline[]
  mlModels MLModel[]
  mlExperiments MLExperiment[]
  mlDeployments MLDeployment[]
  dataLakeResources DataLakeResource[]
  dataLakeQueries DataLakeQuery[]
  dataLakeSchemas DataLakeSchema[]
  businessProcesses BusinessProcess[]
  processInstances ProcessInstance[]
  processActivities ProcessActivity[]
  contracts Contract[]
  contractRevisions ContractRevision[]
  contractApprovals ContractApproval[]
  vendors Vendor[]
  vendorContracts VendorContract[]
  vendorEvaluations VendorEvaluation[]
  projects Project[]
  projectTasks ProjectTask[]
  projectMilestones ProjectMilestone[]
  projectResources ProjectResource[]
  timeEntries TimeEntry[]
  timesheets Timesheet[]
  projectTimeReports ProjectTimeReport[]
  
  @@map("tenants")
}

model User {
  id          String     @id @default(cuid())
  tenantId    String
  email       String
  name        String
  avatar      String?
  role        UserRole   @default(MEMBER)
  status      UserStatus @default(pending)
  permissions String[]
  passwordHash String
  emailVerified Boolean @default(false)
  emailVerificationToken String?
  emailVerificationExpiry DateTime?
  emailVerifiedAt DateTime?
  passwordResetToken String?
  passwordResetExpiry DateTime?
  passwordChangedAt DateTime?
  lastLoginAt DateTime?
  lastLoginIp String?
  twoFactorEnabled Boolean @default(false)
  twoFactorSecret String?
  twoFactorBackupCodes Json?
  inviteAcceptedAt DateTime?
  metadata    Json?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  // Relations
  tenant      Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  authoredPages Page[] @relation("PageAuthor")
  editedPages   Page[] @relation("PageEditor")
  uploadedMedia Media[]
  createdEvents Event[] @relation("EventCreator")
  eventRSVPs    EventRSVP[]
  payments      Payment[]
  donations     Donation[]
  subscriptions Subscription[]
  sentNotifications Notification[] @relation("NotificationSender")
  receivedNotifications Notification[] @relation("NotificationRecipient")
  createdApiKeys        ApiKey[] @relation("ApiKeyCreator")
  createdBackups        Backup[] @relation("BackupCreator")
  createdIntegrations   Integration[] @relation("IntegrationCreator")
  auditLogs             AuditLog[]
  
  // CMS relationships
  contentTypes    ContentType[] @relation("ContentTypeCreator")
  authoredContent Content[] @relation("ContentAuthor")
  editedContent   Content[] @relation("ContentEditor")
  revisions       ContentRevision[] @relation("RevisionAuthor")
  translations    ContentTranslation[] @relation("ContentTranslator")
  comments        Comment[] @relation("CommentAuthor")
  moderatedComments Comment[] @relation("CommentModerator")
  contentTemplates ContentTemplate[] @relation("TemplateCreator")
  
  // Event management relationships
  eventTickets    EventTicket[] @relation("UserTickets")
  checkedInTickets EventTicket[] @relation("TicketCheckedInBy")
  sessionAttendees SessionAttendee[] @relation("SessionAttendee")
  eventWaitlists  EventWaitlist[] @relation("EventWaitlist")
  eventReminders  EventReminder[] @relation("EventReminders")
  eventFeedback   EventFeedback[] @relation("EventFeedback")
  
  // Member portal relationships
  memberApplications MemberApplication[]
  reviewedApplications MemberApplication[] @relation("ApplicationReviewer")
  memberPoints    MemberPoints[]
  volunteerLogs   VolunteerLog[]
  badges          UserBadge[]
  
  // Performance Monitoring relationships
  createdPerformanceAlerts PerformanceAlert[]
  createdPerformanceProfiles PerformanceProfile[]
  createdPerformanceBenchmarks PerformanceBenchmark[]
  
  // Advanced Analytics relationships
  createdAnalyticsDashboards AnalyticsDashboard[]
  createdAnalyticsMetrics AnalyticsMetric[]
  createdAnalyticsQueries AnalyticsQuery[]
  createdAnalyticsAlerts AnalyticsAlert[]
  createdCohortAnalyses CohortAnalysis[]
  createdFunnelAnalyses FunnelAnalysis[]
  createdRetentionAnalyses RetentionAnalysis[]
  createdSegmentAnalyses SegmentAnalysis[]
  
  // AI/ML Features relationships
  createdAIModels AIModel[]
  createdRecommendationEngines RecommendationEngine[]
  createdChatSessions ChatSession[]
  createdAutomationRules AutomationRule[]
  
  // Data Export/Import relationships
  createdDataExports DataExport[]
  createdDataImports DataImport[]
  createdDataTemplates DataTemplate[]
  createdDataSyncs DataSync[]
  createdDataBackups DataBackup[]
  
  // Push Notification relationships
  createdNotificationTemplates NotificationTemplate[]
  createdNotificationCampaigns NotificationCampaign[]
  pushDevices PushDevice[]
  notificationPreferences NotificationPreference[]
  
  // Advanced Search relationships
  createdSearchIndices SearchIndex[]
  savedSearches SavedSearch[]
  
  // Communication Hub relationships
  createdChannels CommunicationChannel[] @relation("ChannelCreator")
  channelMemberships ChannelMember[] @relation("ChannelMembers")
  authoredMessages Message[] @relation("MessageAuthor")
  pinnedMessages Message[] @relation("MessagePinner")
  createdThreads MessageThread[] @relation("ThreadCreator")
  lockedThreads MessageThread[] @relation("ThreadLocker")
  messageReactions MessageReaction[]
  messageMentions MessageMention[]
  sentChannelInvitations ChannelInvitation[] @relation("InvitationSender")
  receivedChannelInvitations ChannelInvitation[] @relation("InvitationRecipient")
  sentDirectMessages DirectMessage[] @relation("DMSender")
  receivedDirectMessages DirectMessage[] @relation("DMRecipient")
  dmReactions DMReaction[]
  createdAnnouncements Announcement[]
  announcementRecipients AnnouncementRecipient[]
  createdForums Forum[]
  forumModerators ForumModerator[]
  createdForumTopics ForumTopic[]
  authoredForumPosts ForumPost[]
  
  // Internationalization relationships
  reviewedTranslations Translation[] @relation("Reviewer")
  contentTranslations ContentTranslation[] @relation("ContentTranslator")
  reviewedContentTranslations ContentTranslation[] @relation("ContentReviewer")
  
  // Workflow Automation relationships
  createdWorkflows Workflow[]
  createdWorkflowTemplates WorkflowTemplate[]
  
  // Advanced Security relationships
  createdSecurityPolicies SecurityPolicy[]
  securityViolations SecurityViolation[]
  resolvedViolations SecurityViolation[] @relation("ViolationResolver")
  scheduledSecurityScans SecurityScan[] @relation("SecurityScanScheduler")
  assignedIncidents SecurityIncident[] @relation("IncidentAssignee")
  reportedIncidents SecurityIncident[] @relation("IncidentReporter")
  acknowledgedAlerts SecurityAlert[] @relation("AlertAcknowledger")
  resolvedAlerts SecurityAlert[] @relation("AlertResolver")
  securityAuditLogs SecurityAuditLog[] @relation("SecurityAuditUser")
  createdBaselines SecurityBaseline[] @relation("BaselineCreator")
  modifiedConfigurations SecurityConfiguration[] @relation("ConfigModifier")
  
  // Steps 46-55 relationships
  assignedAssets Asset[] @relation("AssetAssignee")
  performedMaintenance AssetMaintenance[] @relation("MaintenanceTechnician")
  complianceAssessments ComplianceAssessment[] @relation("ComplianceAssessor")
  createdAllocations ResourceAllocation[] @relation("AllocationCreator")
  writtenArticles KnowledgeArticle[] @relation("ArticleAuthor")
  articleFeedbacks ArticleFeedback[] @relation("FeedbackUser")
  assignedTickets SupportTicket[] @relation("TicketAssignee")
  customerTickets SupportTicket[] @relation("TicketCustomer")
  sentMessages TicketMessage[] @relation("MessageSender")
  createdPosts SocialPost[] @relation("PostCreator")
  mobileDevices MobileDevice[] @relation("UserDevices")
  deployedContracts SmartContract[] @relation("ContractDeployer")
  
  // Steps 56-65 relationships
  hostedStreams Stream[] @relation("StreamHost")
  attendedEvents EventAttendee[] @relation("EventAttendeeUser")
  hostedSessions EventSession[] @relation("SessionHost")
  sessionSpeakers EventSessionSpeaker[] @relation("SessionSpeaker")
  createdARExperiences ARExperience[] @relation("ARCreator")
  arInteractions ARInteraction[] @relation("ARUser")
  createdPipelines MLPipeline[] @relation("PipelineCreator")
  createdMLModels MLModel[] @relation("MLModelCreator")
  runExperiments MLExperiment[] @relation("ExperimentRunner")
  deployedModels MLDeployment[] @relation("DeploymentUser")
  executedQueries DataLakeQuery[] @relation("QueryExecutor")
  ownedProcesses BusinessProcess[] @relation("ProcessOwner")
  startedInstances ProcessInstance[] @relation("InstanceStarter")
  activityAssignments ProcessActivity[] @relation("ActivityAssignee")
  createdContracts Contract[] @relation("ContractCreator")
  approvedContracts ContractApproval[] @relation("ContractApprover")
  vendorContacts Vendor[] @relation("VendorContact")
  evaluatedVendors VendorEvaluation[] @relation("VendorEvaluator")
  projectManagers Project[] @relation("ProjectManager")
  taskAssignees ProjectTask[] @relation("TaskAssignee")
  taskCreators ProjectTask[] @relation("TaskCreator")
  timeEntries TimeEntry[] @relation("TimeEntryUser")
  timesheetApprovers Timesheet[] @relation("TimesheetApprover")
  
  @@unique([tenantId, email])
  @@map("users")
}

model Organization {
  id          String   @id @default(cuid())
  tenantId    String
  name        String
  type        OrgType  @default(CAMP)
  description String?
  logo        String?
  website     String?
  location    String?
  settings    Json
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  tenant      Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  pages       Page[]
  
  @@map("organizations")
}

model Page {
  id             String      @id @default(cuid())
  tenantId       String
  organizationId String?
  title          String
  slug           String
  content        Json        // Structured content blocks
  metaTitle      String?
  metaDescription String?
  status         PageStatus  @default(DRAFT)
  publishedAt    DateTime?
  templateId     String?
  settings       Json?       // Page-specific settings
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt
  createdBy      String
  updatedBy      String

  // Relations
  tenant         Tenant       @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  organization   Organization? @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  author         User         @relation("PageAuthor", fields: [createdBy], references: [id])
  editor         User         @relation("PageEditor", fields: [updatedBy], references: [id])
  template       Template?    @relation(fields: [templateId], references: [id])
  
  @@unique([tenantId, slug])
  @@map("pages")
}

model Template {
  id          String   @id @default(cuid())
  tenantId    String?  // null for global templates
  name        String
  description String?
  preview     String?  // URL to preview image
  content     Json     // Template structure
  category    String
  isPublic    Boolean  @default(false)
  price       Int?     // in cents, null for free
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  tenant      Tenant? @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  pages       Page[]
  
  @@map("templates")
}

model Media {
  id          String    @id @default(cuid())
  tenantId    String
  filename    String
  originalName String
  mimeType    String
  size        Int       // in bytes
  url         String
  thumbnailUrl String?
  alt         String?
  caption     String?
  folder      String?   // organizational folder
  tags        String[]  // searchable tags
  metadata    Json?     // EXIF data, dimensions, etc.
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  uploadedBy  String

  // Relations
  tenant      Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  uploader    User   @relation(fields: [uploadedBy], references: [id])
  
  @@map("media")
}

model ContentBlock {
  id          String         @id @default(cuid())
  tenantId    String
  name        String
  description String?
  type        ContentBlockType
  schema      Json           // JSON schema for the block
  component   String         // React component name
  category    String
  icon        String?
  isPublic    Boolean        @default(false)
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt

  // Relations
  tenant      Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  
  @@map("content_blocks")
}

model Event {
  id           String      @id @default(cuid())
  tenantId     String
  title        String
  description  String?
  content      Json?       // Rich content for event details
  type         EventType   @default(GENERAL)
  category     String?     // Workshop, Social, Art Build, etc.
  startDate    DateTime
  endDate      DateTime?
  location     String?
  address      String?
  maxAttendees Int?
  price        Int?        // in cents, null for free
  isPublic     Boolean     @default(true)
  status       EventStatus @default(DRAFT)
  metadata     Json?       // Additional event data
  settings     Json?       // Event-specific settings
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  createdBy    String

  // Relations
  tenant       Tenant      @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  creator      User        @relation("EventCreator", fields: [createdBy], references: [id])
  rsvps        EventRSVP[]
  payments     Payment[]
  ticketTypes  EventTicketType[]
  sessions     EventSession[]
  sponsors     EventSponsor[]
  waitlists    EventWaitlist[]
  reminders    EventReminder[]
  feedback     EventFeedback[]
  volunteerLogs VolunteerLog[]
  
  @@index([tenantId, startDate])
  @@index([tenantId, status])
  @@index([type, startDate])
  @@map("events")
}

model EventTicketType {
  id            String   @id @default(cuid())
  eventId       String
  tenantId      String
  name          String
  description   String?
  price         Int      // in cents
  quantity      Int      // Total tickets available
  sold          Int      @default(0)
  maxPerPerson  Int      @default(1)
  saleStartDate DateTime?
  saleEndDate   DateTime?
  isActive      Boolean  @default(true)
  metadata      Json?    // Additional ticket data
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  event         Event         @relation(fields: [eventId], references: [id], onDelete: Cascade)
  tenant        Tenant        @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  tickets       EventTicket[]

  @@index([eventId, isActive])
  @@map("event_ticket_types")
}

model EventTicket {
  id            String   @id @default(cuid())
  ticketTypeId  String
  userId        String
  tenantId      String
  ticketNumber  String   @unique // Generated ticket number
  status        TicketStatus @default(valid)
  purchasePrice Int      // Price paid in cents
  qrCode        String?  // QR code for check-in
  checkedInAt   DateTime?
  checkedInBy   String?
  metadata      Json?    // Additional ticket data
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  ticketType    EventTicketType @relation(fields: [ticketTypeId], references: [id], onDelete: Cascade)
  user          User            @relation("UserTickets", fields: [userId], references: [id])
  tenant        Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  checkedInByUser User?         @relation("TicketCheckedInBy", fields: [checkedInBy], references: [id])

  @@index([userId, status])
  @@index([ticketTypeId, status])
  @@map("event_tickets")
}

model EventSession {
  id          String   @id @default(cuid())
  eventId     String
  tenantId    String
  title       String
  description String?
  startTime   DateTime
  endTime     DateTime
  location    String?
  maxAttendees Int?
  speakers    Json?    // Array of speaker information
  materials   Json?    // Required materials or preparation
  level       SessionLevel @default(BEGINNER)
  tags        String[]
  isRequired  Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  event       Event             @relation(fields: [eventId], references: [id], onDelete: Cascade)
  tenant      Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  attendees   SessionAttendee[]

  @@index([eventId, startTime])
  @@map("event_sessions")
}

model SessionAttendee {
  id        String      @id @default(cuid())
  sessionId String
  userId    String
  status    AttendeeStatus @default(REGISTERED)
  notes     String?
  rating    Int?        // 1-5 rating after session
  feedback  String?
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt

  // Relations
  session   EventSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  user      User         @relation("SessionAttendee", fields: [userId], references: [id])

  @@unique([sessionId, userId])
  @@map("session_attendees")
}

model EventSponsor {
  id          String       @id @default(cuid())
  eventId     String
  tenantId    String
  name        String
  logo        String?
  website     String?
  description String?
  level       SponsorLevel @default(BRONZE)
  amount      Int?         // Sponsorship amount in cents
  benefits    Json?        // Array of sponsor benefits
  isActive    Boolean      @default(true)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  // Relations
  event       Event        @relation(fields: [eventId], references: [id], onDelete: Cascade)
  tenant      Tenant       @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([eventId, level])
  @@map("event_sponsors")
}

model EventWaitlist {
  id          String   @id @default(cuid())
  eventId     String
  userId      String
  tenantId    String
  position    Int      // Position in waitlist
  notified    Boolean  @default(false)
  expiresAt   DateTime?
  metadata    Json?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  event       Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  user        User     @relation("EventWaitlist", fields: [userId], references: [id])
  tenant      Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([eventId, userId])
  @@index([eventId, position])
  @@map("event_waitlists")
}

model EventReminder {
  id        String    @id @default(cuid())
  eventId   String
  userId    String
  tenantId  String
  type      ReminderType
  sendAt    DateTime
  sent      Boolean   @default(false)
  sentAt    DateTime?
  method    NotificationChannel @default(EMAIL)
  metadata  Json?
  createdAt DateTime  @default(now())

  // Relations
  event     Event     @relation(fields: [eventId], references: [id], onDelete: Cascade)
  user      User      @relation("EventReminders", fields: [userId], references: [id])
  tenant    Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([sendAt, sent])
  @@index([eventId, type])
  @@map("event_reminders")
}

model EventFeedback {
  id          String   @id @default(cuid())
  eventId     String
  userId      String
  tenantId    String
  rating      Int      // 1-5 overall rating
  feedback    String?
  categories  Json?    // Ratings for different aspects
  wouldRecommend Boolean?
  suggestions String?
  isAnonymous Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  event       Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  user        User     @relation("EventFeedback", fields: [userId], references: [id])
  tenant      Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([eventId, userId])
  @@index([eventId, rating])
  @@map("event_feedback")
}

model EventRSVP {
  id         String     @id @default(cuid())
  tenantId   String
  eventId    String
  userId     String
  status     RSVPStatus @default(pending)
  response   String?    // Additional response/notes
  attendees  Int        @default(1) // Number of people this RSVP covers
  metadata   Json?      // Additional RSVP data
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt

  // Relations
  tenant     Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  event      Event  @relation(fields: [eventId], references: [id], onDelete: Cascade)
  user       User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@unique([eventId, userId])
  @@map("event_rsvps")
}

model Payment {
  id              String        @id @default(cuid())
  tenantId        String
  userId          String
  amount          Int           // in cents
  currency        String        @default("USD")
  type            PaymentType
  status          PaymentStatus @default(pending)
  stripePaymentId String?       @unique
  stripeCustomerId String?
  metadata        Json?         // Additional payment data
  description     String?
  eventId         String?       // If payment is for event
  donationId      String?      // If payment is a donation
  subscriptionId  String?       // If payment is for subscription
  refundedAmount  Int?          // Amount refunded in cents
  failureReason   String?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  // Relations
  tenant          Tenant        @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user            User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  event           Event?        @relation(fields: [eventId], references: [id], onDelete: SetNull)
  donation        Donation?     @relation(fields: [donationId], references: [id], onDelete: SetNull)
  subscription    Subscription? @relation(fields: [subscriptionId], references: [id], onDelete: SetNull)
  
  @@map("payments")
}

model Donation {
  id              String         @id @default(cuid())
  tenantId        String
  userId          String?        // null for anonymous donations
  amount          Int            // in cents
  currency        String         @default("USD")
  type            DonationType   @default(ONE_TIME)
  status          DonationStatus @default(pending)
  campaign        String?        // Campaign or fund name
  message         String?        // Donor message
  isAnonymous     Boolean        @default(false)
  metadata        Json?          // Additional donation data
  taxReceiptSent  Boolean        @default(false)
  acknowledgeSent Boolean        @default(false)
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt

  // Relations
  tenant          Tenant         @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user            User?          @relation(fields: [userId], references: [id], onDelete: SetNull)
  payment         Payment[]
  
  @@map("donations")
}

model Subscription {
  id                 String             @id @default(cuid())
  tenantId           String
  userId             String
  plan               String             // Plan identifier
  amount             Int                // in cents per billing period
  currency           String             @default("USD")
  interval           BillingInterval    @default(MONTHLY)
  status             SubscriptionStatus @default(ACTIVE)
  stripeSubscriptionId String?          @unique
  stripeCustomerId   String?
  currentPeriodStart DateTime
  currentPeriodEnd   DateTime
  cancelledAt        DateTime?
  cancelReason       String?
  metadata           Json?              // Additional subscription data
  createdAt          DateTime           @default(now())
  updatedAt          DateTime           @updatedAt

  // Relations
  tenant             Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user               User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  payments           Payment[]
  
  @@map("subscriptions")
}

model Notification {
  id          String             @id @default(cuid())
  tenantId    String
  senderId    String?            // null for system notifications
  recipientId String
  type        NotificationType
  title       String
  message     String
  data        Json?              // Additional notification data
  isRead      Boolean            @default(false)
  readAt      DateTime?
  channel     NotificationChannel @default(IN_APP)
  priority    NotificationPriority @default(NORMAL)
  expiresAt   DateTime?
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt

  // Relations
  tenant      Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  sender      User?  @relation("NotificationSender", fields: [senderId], references: [id], onDelete: SetNull)
  recipient   User   @relation("NotificationRecipient", fields: [recipientId], references: [id], onDelete: Cascade)
  
  @@index([recipientId, isRead])
  @@index([tenantId, createdAt])
  @@map("notifications")
}

model ApiKey {
  id          String   @id @default(cuid())
  tenantId    String
  name        String
  description String?
  keyHash     String   @unique // SHA256 hash of the actual key
  permissions String[] // Array of permission strings
  rateLimit   Int      @default(1000) // Requests per hour
  isActive    Boolean  @default(true)
  lastUsedAt  DateTime?
  usageCount  Int      @default(0)
  expiresAt   DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  createdBy   String   // User ID who created this key

  // Relations
  tenant      Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  creator     User   @relation("ApiKeyCreator", fields: [createdBy], references: [id])

  @@map("api_keys")
}

model Backup {
  id          String       @id @default(cuid())
  tenantId    String
  type        BackupType
  size        BigInt
  compressed  Boolean      @default(false)
  encrypted   Boolean      @default(false)
  checksum    String
  storagePath String
  storageType BackupStorageType @default(local)
  status      BackupStatus @default(pending)
  error       String?
  metadata    Json?
  expiresAt   DateTime?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  createdBy   String

  // Relations
  tenant      Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  creator     User   @relation("BackupCreator", fields: [createdBy], references: [id])

  @@map("backups")
}

model Integration {
  id          String             @id @default(cuid())
  tenantId    String
  name        String
  description String?
  category    IntegrationCategory
  provider    String
  enabled     Boolean            @default(true)
  settings    Json               @default("{}")
  credentials Json               // Encrypted credentials
  webhookUrl  String?
  webhookSecret String?
  rateLimits  Json?
  scopes      String[]
  version     String             @default("1.0.0")
  lastSyncAt  DateTime?
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  createdBy   String

  // Relations
  tenant        Tenant         @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  creator       User           @relation("IntegrationCreator", fields: [createdBy], references: [id])
  webhookEvents WebhookEvent[]

  @@map("integrations")
}

model WebhookEvent {
  id            String      @id @default(cuid())
  tenantId      String
  integrationId String
  event         String
  payload       Json
  headers       Json
  signature     String?
  verified      Boolean     @default(false)
  processed     Boolean     @default(false)
  error         String?
  retryCount    Int         @default(0)
  maxRetries    Int         @default(3)
  nextRetryAt   DateTime?
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  // Relations
  tenant      Tenant      @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  integration Integration @relation(fields: [integrationId], references: [id], onDelete: Cascade)

  @@map("webhook_events")
}

model AuditLog {
  id         String         @id @default(cuid())
  tenantId   String?
  userId     String?
  action     String
  resource   String
  resourceId String?
  ip         String
  userAgent  String
  metadata   Json           @default("{}")
  severity   AuditSeverity
  timestamp  DateTime       @default(now())

  // Relations
  tenant Tenant? @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user   User?   @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@index([tenantId, timestamp])
  @@index([userId, timestamp])
  @@index([action, timestamp])
  @@index([severity, timestamp])
  @@map("audit_logs")
}

model ContentType {
  id          String   @id @default(cuid())
  name        String   // e.g., "Page", "Blog Post", "Event"
  slug        String   // e.g., "page", "blog_post", "event"
  description String?
  
  // Schema definition for this content type
  schema      Json     // JSON schema defining fields and validation
  
  // Display configuration
  displayName String   // Singular name for UI
  pluralName  String   // Plural name for UI
  icon        String?  // Icon identifier
  
  // Permissions and workflow
  permissions Json     // Role-based permissions
  workflow    Json?    // Approval workflow configuration
  
  // Settings
  isEnabled   Boolean  @default(true)
  isPublic    Boolean  @default(false) // Can be viewed by non-members
  allowComments Boolean @default(false)
  
  // Relationships
  tenantId    String
  tenant      Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  
  contents    Content[]
  categories  Category[]
  templates   ContentTemplate[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  createdBy   String
  creator     User     @relation("ContentTypeCreator", fields: [createdBy], references: [id])
  
  @@unique([tenantId, slug])
  @@index([tenantId, isEnabled])
  @@map("content_types")
}

model Content {
  id            String   @id @default(cuid())
  title         String
  slug          String
  excerpt       String?
  
  // Content data stored as JSON based on ContentType schema
  data          Json
  
  // Meta information
  metaTitle     String?
  metaDescription String?
  metaKeywords  String?
  
  // Publishing
  status        ContentStatus @default(DRAFT)
  publishedAt   DateTime?
  scheduledAt   DateTime?
  
  // SEO and Social
  featuredImage String?
  socialImage   String?
  canonicalUrl  String?
  
  // Analytics and engagement
  viewCount     Int      @default(0)
  shareCount    Int      @default(0)
  likeCount     Int      @default(0)
  commentCount  Int      @default(0)
  
  // Content type relationship
  contentTypeId String
  contentType   ContentType @relation(fields: [contentTypeId], references: [id], onDelete: Cascade)
  
  // Tenant relationship
  tenantId      String
  tenant        Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  
  // Categories and tags
  categories    ContentCategory[]
  tags          ContentTag[]
  
  // Media attachments
  media         ContentMedia[]
  
  // Comments
  comments      Comment[]
  
  // Revisions
  revisions     ContentRevision[]
  
  // Translations
  translations  ContentTranslation[]
  
  // Author information
  authorId      String
  author        User     @relation("ContentAuthor", fields: [authorId], references: [id])
  
  // Editor information
  lastEditedBy  String?
  lastEditor    User?    @relation("ContentEditor", fields: [lastEditedBy], references: [id])
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  @@unique([tenantId, contentTypeId, slug])
  @@index([tenantId, status, publishedAt])
  @@index([tenantId, contentTypeId, status])
  @@index([publishedAt])
  @@map("cms_content")
}

model ContentRevision {
  id        String   @id @default(cuid())
  
  // Revision data
  title     String
  data      Json
  excerpt   String?
  
  // Revision metadata
  version   Int
  comment   String?
  
  // Relationships
  contentId String
  content   Content  @relation(fields: [contentId], references: [id], onDelete: Cascade)
  
  authorId  String
  author    User     @relation("RevisionAuthor", fields: [authorId], references: [id])
  
  createdAt DateTime @default(now())
  
  @@index([contentId, version])
  @@map("content_revisions")
}

model ContentTranslation {
  id          String   @id @default(cuid())
  
  language    String   // ISO language code (e.g., "en", "fa", "es")
  title       String
  excerpt     String?
  data        Json
  
  // Meta for this language
  metaTitle     String?
  metaDescription String?
  
  // Translation status
  status      TranslationStatus @default(pending)
  
  // Relationships
  contentId   String
  content     Content  @relation(fields: [contentId], references: [id], onDelete: Cascade)
  
  translatorId String?
  translator   User?    @relation("ContentTranslator", fields: [translatorId], references: [id])
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@unique([contentId, language])
  @@index([language, status])
  @@map("content_translations")
}

model Category {
  id            String   @id @default(cuid())
  name          String
  slug          String
  description   String?
  color         String?  // Hex color code
  icon          String?
  
  // Hierarchy
  parentId      String?
  parent        Category? @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children      Category[] @relation("CategoryHierarchy")
  
  // Display order
  sortOrder     Int      @default(0)
  
  // Content type relationship
  contentTypeId String
  contentType   ContentType @relation(fields: [contentTypeId], references: [id], onDelete: Cascade)
  
  // Tenant relationship
  tenantId      String
  tenant        Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  
  // Content relationships
  contents      ContentCategory[]
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  @@unique([tenantId, contentTypeId, slug])
  @@index([tenantId, contentTypeId])
  @@map("cms_categories")
}

model Tag {
  id        String   @id @default(cuid())
  name      String
  slug      String
  color     String?  // Hex color code
  
  // Tenant relationship
  tenantId  String
  tenant    Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  
  // Content relationships
  contents  ContentTag[]
  
  createdAt DateTime @default(now())
  
  @@unique([tenantId, slug])
  @@index([tenantId])
  @@map("cms_tags")
}

model ContentCategory {
  contentId   String
  content     Content  @relation(fields: [contentId], references: [id], onDelete: Cascade)
  
  categoryId  String
  category    Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  
  @@id([contentId, categoryId])
  @@map("content_categories")
}

model ContentTag {
  contentId   String
  content     Content @relation(fields: [contentId], references: [id], onDelete: Cascade)
  
  tagId       String
  tag         Tag     @relation(fields: [tagId], references: [id], onDelete: Cascade)
  
  @@id([contentId, tagId])
  @@map("content_tags")
}

model ContentMedia {
  id        String   @id @default(cuid())
  
  filename  String
  originalName String
  mimeType  String
  size      Int
  url       String
  
  // Image specific
  width     Int?
  height    Int?
  alt       String?
  caption   String?
  
  // Relationships
  contentId String
  content   Content  @relation(fields: [contentId], references: [id], onDelete: Cascade)
  
  uploadedBy String
  uploader   User     @relation("MediaUploader", fields: [uploadedBy], references: [id])
  
  createdAt DateTime @default(now())
  
  @@index([contentId])
  @@map("content_media")
}

model Comment {
  id        String   @id @default(cuid())
  
  content   String
  status    CommentStatus @default(pending)
  
  // Hierarchy for replies
  parentId  String?
  parent    Comment? @relation("CommentReplies", fields: [parentId], references: [id])
  replies   Comment[] @relation("CommentReplies")
  
  // Relationships
  contentId String
  contentItem Content @relation(fields: [contentId], references: [id], onDelete: Cascade)
  
  authorId  String?
  author    User?    @relation("CommentAuthor", fields: [authorId], references: [id])
  
  // For guest comments
  guestName  String?
  guestEmail String?
  
  // Moderation
  moderatedBy String?
  moderator   User?    @relation("CommentModerator", fields: [moderatedBy], references: [id])
  moderatedAt DateTime?
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@index([contentId, status])
  @@index([createdAt])
  @@map("cms_comments")
}

model ContentTemplate {
  id          String   @id @default(cuid())
  name        String
  description String?
  
  // Template data
  schema      Json     // Field definitions
  defaultData Json?    // Default values
  
  // Template metadata
  category    String?
  tags        String[]
  
  // Usage tracking
  useCount    Int      @default(0)
  
  // Relationships
  contentTypeId String
  contentType   ContentType @relation(fields: [contentTypeId], references: [id], onDelete: Cascade)
  
  tenantId    String
  tenant      Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  
  createdBy   String
  creator     User     @relation("TemplateCreator", fields: [createdBy], references: [id])
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([tenantId, contentTypeId])
  @@map("content_templates")
}

model MemberApplication {
  id          String   @id @default(cuid())
  userId      String
  tenantId    String
  answers     Json     // Application form answers
  references  Json?    // Reference contacts
  status      ApplicationStatus @default(pending)
  reviewedBy  String?
  reviewNotes String?
  submittedAt DateTime @default(now())
  reviewedAt  DateTime?
  
  // Relations
  user        User     @relation(fields: [userId], references: [id])
  tenant      Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  reviewer    User?    @relation("ApplicationReviewer", fields: [reviewedBy], references: [id])
  
  @@index([tenantId, status])
  @@index([userId])
  @@map("member_applications")
}

model MemberPoints {
  id        String   @id @default(cuid())
  userId    String
  tenantId  String
  points    Int
  reason    String
  category  PointCategory
  metadata  Json?
  awardedAt DateTime @default(now())
  
  // Relations
  user      User     @relation(fields: [userId], references: [id])
  tenant    Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  
  @@index([userId, awardedAt])
  @@index([tenantId, category])
  @@map("member_points")
}

model VolunteerLog {
  id          String   @id @default(cuid())
  userId      String
  tenantId    String
  eventId     String?
  taskName    String
  description String?
  hours       Float
  date        DateTime
  verified    Boolean  @default(false)
  verifiedBy  String?
  notes       String?
  createdAt   DateTime @default(now())
  
  // Relations
  user        User     @relation(fields: [userId], references: [id])
  tenant      Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  event       Event?   @relation(fields: [eventId], references: [id])
  
  @@index([userId, date])
  @@index([tenantId, verified])
  @@map("volunteer_logs")
}

model MemberBadge {
  id          String   @id @default(cuid())
  tenantId    String
  name        String
  description String
  icon        String   // Icon URL or identifier
  criteria    Json     // Criteria for earning badge
  points      Int      @default(0) // Points awarded with badge
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  
  // Relations
  tenant      Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  users       UserBadge[]
  
  @@unique([tenantId, name])
  @@map("member_badges")
}

model UserBadge {
  id        String   @id @default(cuid())
  userId    String
  badgeId   String
  earnedAt  DateTime @default(now())
  
  // Relations
  user      User        @relation(fields: [userId], references: [id])
  badge     MemberBadge @relation(fields: [badgeId], references: [id])
  
  @@unique([userId, badgeId])
  @@map("user_badges")
}

model Language {
  id        String   @id @default(cuid())
  code      String   @unique // ISO 639-1 code (e.g., "en", "es", "fa")
  name      String   // English name (e.g., "English", "Spanish", "Persian")
  nativeName String  // Native name (e.g., "English", "Español", "فارسی")
  direction String   @default("ltr") // "ltr" or "rtl"
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  translations Translation[]
  tenantLanguages TenantLanguage[]

  @@map("languages")
}

model TenantLanguage {
  id         String   @id @default(cuid())
  tenantId   String
  languageId String
  isDefault  Boolean  @default(false)
  isActive   Boolean  @default(true)
  createdAt  DateTime @default(now())

  // Relations
  tenant   Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  language Language @relation(fields: [languageId], references: [id], onDelete: Cascade)

  @@unique([tenantId, languageId])
  @@map("tenant_languages")
}

model TranslationKey {
  id          String   @id @default(cuid())
  tenantId    String?  // null for global keys
  namespace   String   // e.g., "common", "navigation", "events"
  key         String   // e.g., "login", "submit", "event.title"
  description String?  // Context for translators
  isPlural    Boolean  @default(false)
  metadata    Json?    // Additional context (character limits, etc.)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  tenant       Tenant?       @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  translations Translation[]

  @@unique([tenantId, namespace, key])
  @@index([namespace, key])
  @@map("translation_keys")
}

model Translation {
  id              String            @id @default(cuid())
  translationKeyId String
  languageId      String
  value           String
  pluralValues    Json?             // For plural forms
  status          TranslationStatus @default(pending)
  translatedBy    String?
  reviewedBy      String?
  translatedAt    DateTime?
  reviewedAt      DateTime?
  version         Int               @default(1)
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt

  // Relations
  translationKey TranslationKey @relation(fields: [translationKeyId], references: [id], onDelete: Cascade)
  language       Language       @relation(fields: [languageId], references: [id], onDelete: Cascade)
  translator     User?          @relation("Translator", fields: [translatedBy], references: [id], onDelete: SetNull)
  reviewer       User?          @relation("Reviewer", fields: [reviewedBy], references: [id], onDelete: SetNull)

  @@unique([translationKeyId, languageId])
  @@index([languageId, status])
  @@map("translations")
}

model CommunicationChannel {
  id          String   @id @default(cuid())
  name        String
  description String?
  type        ChannelType
  isPublic    Boolean  @default(true)
  isArchived  Boolean  @default(false)
  settings    Json     @default("{}")
  metadata    Json     @default("{}")
  createdBy   String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  tenantId    String

  tenant      Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  creator     User               @relation("ChannelCreator", fields: [createdBy], references: [id])
  members     ChannelMember[]
  messages    Message[]
  threads     MessageThread[]
  invitations ChannelInvitation[]

  @@index([tenantId, type])
  @@index([tenantId, isPublic])
  @@map("communication_channels")
}

model ChannelMember {
  id           String         @id @default(cuid())
  channelId    String
  userId       String
  role         ChannelRole    @default(MEMBER)
  permissions  Json           @default("{}")
  joinedAt     DateTime       @default(now())
  lastReadAt   DateTime?
  isMuted      Boolean        @default(false)
  isOnline     Boolean        @default(false)
  lastSeenAt   DateTime?
  tenantId     String

  channel      CommunicationChannel @relation(fields: [channelId], references: [id], onDelete: Cascade)
  user         User                 @relation("ChannelMembers", fields: [userId], references: [id])
  tenant       Tenant               @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([channelId, userId])
  @@index([tenantId, userId])
  @@map("channel_members")
}

model Message {
  id           String        @id @default(cuid())
  channelId    String
  threadId     String?
  authorId     String
  content      String
  contentType  MessageContentType   @default(TEXT)
  attachments  Json          @default("[]")
  metadata     Json          @default("{}")
  isEdited     Boolean       @default(false)
  editedAt     DateTime?
  isDeleted    Boolean       @default(false)
  deletedAt    DateTime?
  isPinned     Boolean       @default(false)
  pinnedAt     DateTime?
  pinnedBy     String?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  tenantId     String

  channel      CommunicationChannel @relation(fields: [channelId], references: [id], onDelete: Cascade)
  thread       MessageThread?       @relation(fields: [threadId], references: [id], onDelete: Cascade)
  author       User                 @relation("MessageAuthor", fields: [authorId], references: [id])
  pinner       User?                @relation("MessagePinner", fields: [pinnedBy], references: [id])
  tenant       Tenant               @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  reactions    MessageReaction[]
  mentions     MessageMention[]
  replies      Message[]            @relation("MessageReplies")
  parent       Message?             @relation("MessageReplies", fields: [threadId], references: [id])

  @@index([tenantId, channelId, createdAt])
  @@index([tenantId, authorId])
  @@index([tenantId, threadId])
  @@map("messages")
}

model MessageThread {
  id          String   @id @default(cuid())
  channelId   String
  rootMessageId String?
  title       String?
  isLocked    Boolean  @default(false)
  lockedBy    String?
  lockedAt    DateTime?
  createdBy   String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  tenantId    String

  channel     CommunicationChannel @relation(fields: [channelId], references: [id], onDelete: Cascade)
  creator     User                 @relation("ThreadCreator", fields: [createdBy], references: [id])
  locker      User?                @relation("ThreadLocker", fields: [lockedBy], references: [id])
  tenant      Tenant               @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  messages    Message[]

  @@index([tenantId, channelId])
  @@map("message_threads")
}

model MessageReaction {
  id        String   @id @default(cuid())
  messageId String
  userId    String
  emoji     String
  createdAt DateTime @default(now())
  tenantId  String

  message   Message @relation(fields: [messageId], references: [id], onDelete: Cascade)
  user      User    @relation("MessageReactions", fields: [userId], references: [id])
  tenant    Tenant  @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([messageId, userId, emoji])
  @@index([tenantId, messageId])
  @@map("message_reactions")
}

model MessageMention {
  id          String   @id @default(cuid())
  messageId   String
  mentionedId String
  type        MentionType
  createdAt   DateTime @default(now())
  tenantId    String

  message     Message @relation(fields: [messageId], references: [id], onDelete: Cascade)
  mentioned   User    @relation("MessageMentions", fields: [mentionedId], references: [id])
  tenant      Tenant  @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([messageId, mentionedId, type])
  @@index([tenantId, mentionedId])
  @@map("message_mentions")
}

model ChannelInvitation {
  id         String            @id @default(cuid())
  channelId  String
  invitedBy  String
  invitedEmail String?
  invitedUserId String?
  role       ChannelRole       @default(MEMBER)
  status     InvitationStatus  @default(pending)
  token      String            @unique
  expiresAt  DateTime
  respondedAt DateTime?
  createdAt  DateTime          @default(now())
  tenantId   String

  channel    CommunicationChannel @relation(fields: [channelId], references: [id], onDelete: Cascade)
  inviter    User                 @relation("ChannelInviter", fields: [invitedBy], references: [id])
  invitee    User?                @relation("ChannelInvitee", fields: [invitedUserId], references: [id])
  tenant     Tenant               @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, status])
  @@index([token])
  @@map("channel_invitations")
}

model DirectMessage {
  id           String        @id @default(cuid())
  senderId     String
  recipientId  String
  content      String
  contentType  MessageContentType   @default(TEXT)
  attachments  Json          @default("[]")
  isRead       Boolean       @default(false)
  readAt       DateTime?
  isEdited     Boolean       @default(false)
  editedAt     DateTime?
  isDeleted    Boolean       @default(false)
  deletedAt    DateTime?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  tenantId     String

  sender       User          @relation("DMSender", fields: [senderId], references: [id])
  recipient    User          @relation("DMRecipient", fields: [recipientId], references: [id])
  tenant       Tenant        @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  reactions    DMReaction[]

  @@index([tenantId, senderId, recipientId])
  @@index([tenantId, recipientId, isRead])
  @@map("direct_messages")
}

model DMReaction {
  id        String   @id @default(cuid())
  messageId String
  userId    String
  emoji     String
  createdAt DateTime @default(now())
  tenantId  String

  message   DirectMessage @relation(fields: [messageId], references: [id], onDelete: Cascade)
  user      User          @relation("DMReactions", fields: [userId], references: [id])
  tenant    Tenant        @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([messageId, userId, emoji])
  @@index([tenantId, messageId])
  @@map("dm_reactions")
}

model Announcement {
  id          String           @id @default(cuid())
  title       String
  content     String
  contentType MessageContentType      @default(TEXT)
  priority    AnnouncementPriority @default(NORMAL)
  isPublished Boolean          @default(false)
  publishedAt DateTime?
  expiresAt   DateTime?
  targetAudience Json          @default("{}")
  attachments Json             @default("[]")
  metadata    Json             @default("{}")
  createdBy   String
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  tenantId    String

  creator     User                    @relation("AnnouncementCreator", fields: [createdBy], references: [id])
  tenant      Tenant                  @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  recipients  AnnouncementRecipient[]

  @@index([tenantId, isPublished, publishedAt])
  @@index([tenantId, priority])
  @@map("announcements")
}

model AnnouncementRecipient {
  id               String       @id @default(cuid())
  announcementId   String
  userId           String
  isRead           Boolean      @default(false)
  readAt           DateTime?
  isDismissed      Boolean      @default(false)
  dismissedAt      DateTime?
  deliveryMethod   String       // 'in_app', 'email', 'push'
  deliveredAt      DateTime?
  createdAt        DateTime     @default(now())
  tenantId         String

  announcement     Announcement @relation(fields: [announcementId], references: [id], onDelete: Cascade)
  user             User         @relation("AnnouncementRecipients", fields: [userId], references: [id])
  tenant           Tenant       @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([announcementId, userId])
  @@index([tenantId, userId, isRead])
  @@map("announcement_recipients")
}

model Forum {
  id          String   @id @default(cuid())
  name        String
  description String?
  slug        String
  isPublic    Boolean  @default(true)
  isModerated Boolean  @default(true)
  settings    Json     @default("{}")
  metadata    Json     @default("{}")
  createdBy   String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  tenantId    String

  creator     User         @relation("ForumCreator", fields: [createdBy], references: [id])
  tenant      Tenant       @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  categories  ForumCategory[]
  moderators  ForumModerator[]

  @@unique([tenantId, slug])
  @@index([tenantId, isPublic])
  @@map("forums")
}

model ForumCategory {
  id          String   @id @default(cuid())
  forumId     String
  name        String
  description String?
  slug        String
  sortOrder   Int      @default(0)
  isLocked    Boolean  @default(false)
  metadata    Json     @default("{}")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  tenantId    String

  forum       Forum        @relation(fields: [forumId], references: [id], onDelete: Cascade)
  tenant      Tenant       @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  topics      ForumTopic[]

  @@unique([forumId, slug])
  @@index([tenantId, forumId, sortOrder])
  @@map("forum_categories")
}

model ForumTopic {
  id          String      @id @default(cuid())
  categoryId  String
  title       String
  content     String
  contentType MessageContentType @default(TEXT)
  isSticky    Boolean     @default(false)
  isLocked    Boolean     @default(false)
  isPinned    Boolean     @default(false)
  views       Int         @default(0)
  tags        Json        @default("[]")
  metadata    Json        @default("{}")
  createdBy   String
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  tenantId    String

  category    ForumCategory @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  creator     User          @relation("TopicCreator", fields: [createdBy], references: [id])
  tenant      Tenant        @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  posts       ForumPost[]

  @@index([tenantId, categoryId, isSticky, isPinned, updatedAt])
  @@index([tenantId, createdBy])
  @@map("forum_topics")
}

model ForumPost {
  id          String      @id @default(cuid())
  topicId     String
  parentId    String?
  content     String
  contentType MessageContentType @default(TEXT)
  isEdited    Boolean     @default(false)
  editedAt    DateTime?
  isDeleted   Boolean     @default(false)
  deletedAt   DateTime?
  metadata    Json        @default("{}")
  createdBy   String
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  tenantId    String

  topic       ForumTopic   @relation(fields: [topicId], references: [id], onDelete: Cascade)
  parent      ForumPost?   @relation("PostReplies", fields: [parentId], references: [id])
  replies     ForumPost[]  @relation("PostReplies")
  creator     User         @relation("PostCreator", fields: [createdBy], references: [id])
  tenant      Tenant       @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, topicId, createdAt])
  @@index([tenantId, createdBy])
  @@map("forum_posts")
}

model ForumModerator {
  id        String   @id @default(cuid())
  forumId   String
  userId    String
  role      ModeratorRole @default(MODERATOR)
  createdAt DateTime @default(now())
  tenantId  String

  forum     Forum    @relation(fields: [forumId], references: [id], onDelete: Cascade)
  user      User     @relation("ForumModerators", fields: [userId], references: [id])
  tenant    Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([forumId, userId])
  @@index([tenantId, userId])
  @@map("forum_moderators")
}

model SearchIndex {
  id          String   @id @default(cuid())
  entityType  String   // 'user', 'event', 'content', 'forum_post', etc.
  entityId    String
  tenantId    String
  title       String
  content     String   @db.Text
  metadata    Json     @default("{}")
  tags        Json     @default("[]")
  searchText  String   @db.Text // Preprocessed search text
  categories  Json     @default("[]")
  status      String   @default("active")
  popularity  Float    @default(0.0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  tenant      Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, entityType])
  @@index([tenantId, searchText])
  @@index([tenantId, status])
  @@fulltext([title, content, searchText])
  @@map("search_indexes")
}

model SearchQuery {
  id          String   @id @default(cuid())
  tenantId    String
  userId      String?
  query       String
  filters     Json     @default("{}")
  results     Int      @default(0)
  executionTime Float  @default(0.0)
  ipAddress   String?
  userAgent   String?
  sessionId   String?
  createdAt   DateTime @default(now())

  tenant      Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user        User?    @relation("SearchQueries", fields: [userId], references: [id], onDelete: SetNull)

  @@index([tenantId, userId])
  @@index([tenantId, createdAt])
  @@map("search_queries")
}

model SearchSuggestion {
  id          String   @id @default(cuid())
  tenantId    String
  suggestion  String
  category    String?
  popularity  Int      @default(0)
  isActive    Boolean  @default(true)
  metadata    Json     @default("{}")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  tenant      Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, suggestion])
  @@index([tenantId, category, popularity])
  @@map("search_suggestions")
}

model SavedSearch {
  id          String   @id @default(cuid())
  tenantId    String
  userId      String
  name        String
  query       String
  filters     Json     @default("{}")
  isPublic    Boolean  @default(false)
  description String?
  metadata    Json     @default("{}")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  tenant      Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user        User     @relation("SavedSearches", fields: [userId], references: [id], onDelete: Cascade)

  @@index([tenantId, userId])
  @@index([tenantId, isPublic])
  @@map("saved_searches")
}

model SearchFacet {
  id          String   @id @default(cuid())
  tenantId    String
  name        String
  type        FacetType
  entityType  String
  fieldPath   String
  displayName String
  isActive    Boolean  @default(true)
  sortOrder   Int      @default(0)
  metadata    Json     @default("{}")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  tenant      Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, name])
  @@index([tenantId, entityType, isActive])
  @@map("search_facets")
}

model SearchResult {
  id            String   @id @default(cuid())
  tenantId      String
  queryId       String?
  entityType    String
  entityId      String
  title         String
  snippet       String?
  score         Float    @default(0.0)
  rank          Int
  metadata      Json     @default("{}")
  clickedAt     DateTime?
  createdAt     DateTime @default(now())

  tenant        Tenant        @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  query         SearchQuery?  @relation(fields: [queryId], references: [id], onDelete: SetNull)

  @@index([tenantId, queryId])
  @@index([tenantId, entityType, score])
  @@map("search_results")
}

model PushDevice {
  id           String   @id @default(cuid())
  userId       String
  tenantId     String
  deviceToken  String   @unique
  platform     Platform
  deviceName   String?
  appVersion   String?
  osVersion    String?
  isActive     Boolean  @default(true)
  lastUsed     DateTime @default(now())
  metadata     Json     @default("{}")
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  user         User               @relation("UserDevices", fields: [userId], references: [id], onDelete: Cascade)
  tenant       Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  notifications PushNotification[]

  @@index([userId, tenantId])
  @@index([platform, isActive])
  @@map("push_devices")
}

model PushNotification {
  id            String   @id @default(cuid())
  tenantId      String
  title         String
  body          String
  data          Json     @default("{}")
  imageUrl      String?
  clickAction   String?
  badge         Int?
  sound         String?
  priority      NotificationPriority @default(NORMAL)
  category      String?
  tags          Json     @default("[]")
  scheduledFor  DateTime?
  expiresAt     DateTime?
  createdBy     String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  tenant        Tenant               @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  creator       User?                @relation("NotificationCreator", fields: [createdBy], references: [id], onDelete: SetNull)
  deliveries    NotificationDelivery[]
  template      NotificationTemplate? @relation(fields: [templateId], references: [id], onDelete: SetNull)
  templateId    String?

  @@index([tenantId, scheduledFor])
  @@index([tenantId, priority])
  @@index([tenantId, category])
  @@map("push_notifications")
}

model NotificationDelivery {
  id              String   @id @default(cuid())
  notificationId  String
  deviceId        String
  status          DeliveryStatus @default(pending)
  sentAt          DateTime?
  deliveredAt     DateTime?
  failedAt        DateTime?
  clickedAt       DateTime?
  error           String?
  retryCount      Int      @default(0)
  metadata        Json     @default("{}")
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  notification    PushNotification @relation(fields: [notificationId], references: [id], onDelete: Cascade)
  device          PushDevice       @relation(fields: [deviceId], references: [id], onDelete: Cascade)

  @@index([notificationId])
  @@index([deviceId, status])
  @@index([status, sentAt])
  @@map("notification_deliveries")
}

model NotificationTemplate {
  id          String   @id @default(cuid())
  tenantId    String
  name        String
  description String?
  title       String
  body        String
  data        Json     @default("{}")
  imageUrl    String?
  clickAction String?
  sound       String?
  category    String?
  variables   Json     @default("[]")
  isActive    Boolean  @default(true)
  metadata    Json     @default("{}")
  createdBy   String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  tenant        Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  creator       User               @relation("TemplateCreator", fields: [createdBy], references: [id])
  notifications PushNotification[]

  @@unique([tenantId, name])
  @@index([tenantId, isActive])
  @@map("notification_templates")
}

model NotificationPreference {
  id          String   @id @default(cuid())
  userId      String
  tenantId    String
  category    String
  isEnabled   Boolean  @default(true)
  priority    NotificationPriority @default(NORMAL)
  quietHours  Json?    // { start: "22:00", end: "08:00", timezone: "UTC" }
  frequency   NotificationFrequency @default(IMMEDIATE)
  metadata    Json     @default("{}")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user        User     @relation("NotificationPreferences", fields: [userId], references: [id], onDelete: Cascade)
  tenant      Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([userId, tenantId, category])
  @@index([tenantId, category])
  @@map("notification_preferences")
}

model NotificationCampaign {
  id            String   @id @default(cuid())
  tenantId      String
  name          String
  description   String?
  templateId    String
  targetAudience Json    @default("{}")
  scheduledFor  DateTime?
  status        CampaignStatus @default(DRAFT)
  totalTargets  Int      @default(0)
  sentCount     Int      @default(0)
  deliveredCount Int     @default(0)
  clickedCount  Int      @default(0)
  failedCount   Int      @default(0)
  metadata      Json     @default("{}")
  createdBy     String
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  tenant        Tenant               @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  template      NotificationTemplate @relation(fields: [templateId], references: [id], onDelete: Cascade)
  creator       User                 @relation("CampaignCreator", fields: [createdBy], references: [id])

  @@index([tenantId, status])
  @@index([tenantId, scheduledFor])
  @@map("notification_campaigns")
}

model NotificationAnalytics {
  id            String   @id @default(cuid())
  tenantId      String
  date          DateTime
  category      String?
  platform      Platform?
  totalSent     Int      @default(0)
  totalDelivered Int     @default(0)
  totalClicked  Int      @default(0)
  totalFailed   Int      @default(0)
  deliveryRate  Float    @default(0)
  clickRate     Float    @default(0)
  metadata      Json     @default("{}")
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  tenant        Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, date, category, platform])
  @@index([tenantId, date])
  @@map("notification_analytics")
}

model DataExport {
  id            String       @id @default(cuid())
  tenantId      String
  name          String
  description   String?
  exportType    ExportType
  format        ExportFormat
  entityTypes   Json         @default("[]")
  filters       Json         @default("{}")
  fields        Json         @default("[]")
  status        ExportStatus @default(pending)
  fileUrl       String?
  fileSize      BigInt?
  recordCount   Int?
  progress      Float        @default(0)
  startedAt     DateTime?
  completedAt   DateTime?
  expiresAt     DateTime?
  error         String?
  metadata      Json         @default("{}")
  createdBy     String
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt

  tenant        Tenant       @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  creator       User         @relation("ExportCreator", fields: [createdBy], references: [id])

  @@index([tenantId, status])
  @@index([tenantId, createdBy])
  @@index([expiresAt])
  @@map("data_exports")
}

model DataImport {
  id            String       @id @default(cuid())
  tenantId      String
  name          String
  description   String?
  importType    ImportType
  format        ImportFormat
  entityType    String
  mapping       Json         @default("{}")
  validation    Json         @default("{}")
  options       Json         @default("{}")
  status        ImportStatus @default(pending)
  fileUrl       String
  fileName      String
  fileSize      BigInt
  totalRecords  Int?
  processedRecords Int       @default(0)
  successfulRecords Int      @default(0)
  failedRecords Int          @default(0)
  progress      Float        @default(0)
  startedAt     DateTime?
  completedAt   DateTime?
  error         String?
  validationReport Json?
  metadata      Json         @default("{}")
  createdBy     String
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt

  tenant        Tenant       @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  creator       User         @relation("ImportCreator", fields: [createdBy], references: [id])
  logs          ImportLog[]

  @@index([tenantId, status])
  @@index([tenantId, createdBy])
  @@map("data_imports")
}

model ImportLog {
  id         String     @id @default(cuid())
  importId   String
  level      LogLevel   @default(info)
  message    String
  rowNumber  Int?
  fieldName  String?
  data       Json?
  createdAt  DateTime   @default(now())

  import     DataImport @relation(fields: [importId], references: [id], onDelete: Cascade)

  @@index([importId, level])
  @@index([importId, createdAt])
  @@map("import_logs")
}

model DataTemplate {
  id          String       @id @default(cuid())
  tenantId    String
  name        String
  description String?
  type        TemplateType
  entityType  String
  format      ExportFormat
  fields      Json         @default("[]")
  filters     Json         @default("{}")
  mapping     Json         @default("{}")
  isPublic    Boolean      @default(false)
  isActive    Boolean      @default(true)
  metadata    Json         @default("{}")
  createdBy   String
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  tenant      Tenant       @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  creator     User         @relation("TemplateCreator", fields: [createdBy], references: [id])

  @@unique([tenantId, name, type])
  @@index([tenantId, entityType, isActive])
  @@map("data_templates")
}

model DataSync {
  id            String     @id @default(cuid())
  tenantId      String
  name          String
  description   String?
  sourceType    SyncSourceType
  targetType    SyncTargetType
  sourceConfig  Json       @default("{}")
  targetConfig  Json       @default("{}")
  mapping       Json       @default("{}")
  schedule      String?    // Cron expression
  isActive      Boolean    @default(true)
  lastRunAt     DateTime?
  nextRunAt     DateTime?
  status        SyncStatus @default(IDLE)
  metadata      Json       @default("{}")
  createdBy     String
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt

  tenant        Tenant     @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  creator       User       @relation("SyncCreator", fields: [createdBy], references: [id])
  runs          SyncRun[]

  @@index([tenantId, isActive])
  @@index([nextRunAt])
  @@map("data_syncs")
}

model SyncRun {
  id              String     @id @default(cuid())
  syncId          String
  status          SyncRunStatus @default(running)
  startedAt       DateTime   @default(now())
  completedAt     DateTime?
  recordsRead     Int        @default(0)
  recordsWritten  Int        @default(0)
  recordsSkipped  Int        @default(0)
  recordsFailed   Int        @default(0)
  error           String?
  logs            Json       @default("[]")
  metadata        Json       @default("{}")

  sync            DataSync   @relation(fields: [syncId], references: [id], onDelete: Cascade)

  @@index([syncId, startedAt])
  @@map("sync_runs")
}

model DataBackup {
  id          String       @id @default(cuid())
  tenantId    String
  name        String
  description String?
  backupType  BackupType
  status      BackupStatus @default(pending)
  fileUrl     String?
  fileSize    BigInt?
  entityTypes Json         @default("[]")
  compression Boolean      @default(true)
  encryption  Boolean      @default(true)
  startedAt   DateTime?
  completedAt DateTime?
  expiresAt   DateTime?
  error       String?
  metadata    Json         @default("{}")
  createdBy   String
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  tenant      Tenant       @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  creator     User         @relation("BackupCreator", fields: [createdBy], references: [id])

  @@index([tenantId, backupType])
  @@index([tenantId, status])
  @@index([expiresAt])
  @@map("data_backups")
}

model AIModel {
  id          String    @id @default(cuid())
  tenantId    String
  name        String
  description String?
  type        ModelType
  provider    AIProvider
  config      Json      @default("{}")
  version     String    @default("1.0.0")
  status      ModelStatus @default(TRAINING)
  accuracy    Float?
  isActive    Boolean   @default(true)
  trainedAt   DateTime?
  deployedAt  DateTime?
  metadata    Json      @default("{}")
  createdBy   String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  tenant      Tenant      @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  creator     User        @relation("ModelCreator", fields: [createdBy], references: [id])
  predictions AIPrediction[]
  trainingSessions TrainingSession[]

  @@unique([tenantId, name])
  @@index([tenantId, type, status])
  @@map("ai_models")
}

model AIPrediction {
  id          String      @id @default(cuid())
  tenantId    String
  modelId     String
  entityType  String      // 'user', 'event', 'donation', etc.
  entityId    String
  inputData   Json
  outputData  Json
  confidence  Float?
  status      PredictionStatus @default(pending)
  executedAt  DateTime?
  error       String?
  metadata    Json        @default("{}")
  createdAt   DateTime    @default(now())

  tenant      Tenant      @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  model       AIModel     @relation(fields: [modelId], references: [id], onDelete: Cascade)

  @@index([tenantId, modelId, status])
  @@index([tenantId, entityType, entityId])
  @@map("ai_predictions")
}

model TrainingSession {
  id            String          @id @default(cuid())
  modelId       String
  datasetSize   Int
  trainingData  Json?
  parameters    Json            @default("{}")
  status        TrainingStatus  @default(running)
  progress      Float           @default(0)
  accuracy      Float?
  loss          Float?
  epochs        Int?
  startedAt     DateTime        @default(now())
  completedAt   DateTime?
  error         String?
  logs          Json            @default("[]")
  metadata      Json            @default("{}")

  model         AIModel         @relation(fields: [modelId], references: [id], onDelete: Cascade)

  @@index([modelId, status])
  @@map("training_sessions")
}

model AIInsight {
  id          String      @id @default(cuid())
  tenantId    String
  type        InsightType
  title       String
  description String
  data        Json
  priority    InsightPriority @default(medium)
  category    String?
  entityType  String?
  entityId    String?
  isRead      Boolean     @default(false)
  readAt      DateTime?
  readBy      String?
  validUntil  DateTime?
  metadata    Json        @default("{}")
  createdAt   DateTime    @default(now())

  tenant      Tenant      @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  reader      User?       @relation("InsightReader", fields: [readBy], references: [id], onDelete: SetNull)

  @@index([tenantId, type, isRead])
  @@index([tenantId, priority, createdAt])
  @@map("ai_insights")
}

model RecommendationEngine {
  id            String              @id @default(cuid())
  tenantId      String
  name          String
  description   String?
  type          RecommendationType
  algorithm     String
  config        Json                @default("{}")
  isActive      Boolean             @default(true)
  lastTrainedAt DateTime?
  accuracy      Float?
  metadata      Json                @default("{}")
  createdBy     String
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  creator       User                @relation("EngineCreator", fields: [createdBy], references: [id])
  recommendations Recommendation[]

  @@unique([tenantId, name])
  @@index([tenantId, type, isActive])
  @@map("recommendation_engines")
}

model Recommendation {
  id          String              @id @default(cuid())
  engineId    String
  userId      String
  itemType    String              // 'event', 'content', 'user', etc.
  itemId      String
  score       Float
  reason      String?
  isClicked   Boolean             @default(false)
  clickedAt   DateTime?
  isDismissed Boolean             @default(false)
  dismissedAt DateTime?
  expiresAt   DateTime?
  metadata    Json                @default("{}")
  createdAt   DateTime            @default(now())

  engine      RecommendationEngine @relation(fields: [engineId], references: [id], onDelete: Cascade)
  user        User                @relation("UserRecommendations", fields: [userId], references: [id], onDelete: Cascade)

  @@index([engineId, userId])
  @@index([userId, itemType, isClicked])
  @@map("recommendations")
}

model ChatSession {
  id          String        @id @default(cuid())
  tenantId    String
  userId      String?
  sessionId   String        @unique
  title       String?
  context     Json          @default("{}")
  isActive    Boolean       @default(true)
  endedAt     DateTime?
  metadata    Json          @default("{}")
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  tenant      Tenant        @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user        User?         @relation("ChatSessions", fields: [userId], references: [id], onDelete: SetNull)
  messages    ChatMessage[]

  @@index([tenantId, userId])
  @@index([sessionId])
  @@map("chat_sessions")
}

model ChatMessage {
  id          String      @id @default(cuid())
  sessionId   String
  role        MessageRole
  content     String      @db.Text
  metadata    Json        @default("{}")
  tokens      Int?
  createdAt   DateTime    @default(now())

  session     ChatSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@index([sessionId, createdAt])
  @@map("chat_messages")
}

model ContentAnalysis {
  id            String          @id @default(cuid())
  tenantId      String
  entityType    String
  entityId      String
  analysisType  AnalysisType
  results       Json
  confidence    Float?
  status        AnalysisStatus  @default(pending)
  executedAt    DateTime?
  error         String?
  metadata      Json            @default("{}")
  createdAt     DateTime        @default(now())

  tenant        Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, entityType, entityId])
  @@index([tenantId, analysisType, status])
  @@map("content_analysis")
}

model AutomationRule {
  id          String          @id @default(cuid())
  tenantId    String
  name        String
  description String?
  trigger     Json            // Trigger conditions
  actions     Json            // Actions to execute
  isActive    Boolean         @default(true)
  lastRun     DateTime?
  runCount    Int             @default(0)
  successCount Int            @default(0)
  failCount   Int             @default(0)
  metadata    Json            @default("{}")
  createdBy   String
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt

  tenant      Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  creator     User            @relation("RuleCreator", fields: [createdBy], references: [id])
  executions  RuleExecution[]

  @@index([tenantId, isActive])
  @@map("automation_rules")
}

model RuleExecution {
  id          String           @id @default(cuid())
  ruleId      String
  triggerData Json
  status      ExecutionStatus  @default(running)
  results     Json?
  startedAt   DateTime         @default(now())
  completedAt DateTime?
  error       String?
  metadata    Json             @default("{}")

  rule        AutomationRule   @relation(fields: [ruleId], references: [id], onDelete: Cascade)

  @@index([ruleId, status])
  @@map("rule_executions")
}

model AnalyticsDashboard {
  id          String    @id @default(cuid())
  tenantId    String
  name        String
  description String?
  layout      Json      @default("{}")
  config      Json      @default("{}")
  isPublic    Boolean   @default(false)
  isActive    Boolean   @default(true)
  tags        Json      @default("[]")
  createdBy   String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  tenant      Tenant         @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  creator     User           @relation("DashboardCreator", fields: [createdBy], references: [id])
  widgets     AnalyticsWidget[]
  shares      DashboardShare[]

  @@unique([tenantId, name])
  @@index([tenantId, isActive])
  @@map("analytics_dashboards")
}

model AnalyticsWidget {
  id            String    @id @default(cuid())
  dashboardId   String
  name          String
  type          WidgetType
  config        Json      @default("{}")
  position      Json      @default("{}")
  size          Json      @default("{}")
  dataSource    Json      @default("{}")
  refreshRate   Int       @default(300) // seconds
  isActive      Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  dashboard     AnalyticsDashboard @relation(fields: [dashboardId], references: [id], onDelete: Cascade)

  @@index([dashboardId, isActive])
  @@map("analytics_widgets")
}

model DashboardShare {
  id          String      @id @default(cuid())
  dashboardId String
  sharedWith  String?     // userId
  shareToken  String?     @unique
  permissions Json        @default("{}")
  expiresAt   DateTime?
  isActive    Boolean     @default(true)
  createdBy   String
  createdAt   DateTime    @default(now())

  dashboard   AnalyticsDashboard @relation(fields: [dashboardId], references: [id], onDelete: Cascade)
  creator     User              @relation("ShareCreator", fields: [createdBy], references: [id])
  user        User?             @relation("ShareRecipient", fields: [sharedWith], references: [id], onDelete: SetNull)

  @@index([dashboardId, isActive])
  @@index([shareToken])
  @@map("dashboard_shares")
}

model AnalyticsMetric {
  id          String      @id @default(cuid())
  tenantId    String
  name        String
  displayName String
  description String?
  category    String
  type        MetricType
  formula     String
  unit        String?
  format      String?
  tags        Json        @default("[]")
  isActive    Boolean     @default(true)
  metadata    Json        @default("{}")
  createdBy   String
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  tenant      Tenant      @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  creator     User        @relation("MetricCreator", fields: [createdBy], references: [id])
  values      MetricValue[]

  @@unique([tenantId, name])
  @@index([tenantId, category, isActive])
  @@map("analytics_metrics")
}

model MetricValue {
  id        String   @id @default(cuid())
  metricId  String
  value     Float
  dimensions Json    @default("{}")
  timestamp DateTime
  metadata  Json     @default("{}")
  createdAt DateTime @default(now())

  metric    AnalyticsMetric @relation(fields: [metricId], references: [id], onDelete: Cascade)

  @@index([metricId, timestamp])
  @@index([timestamp])
  @@map("metric_values")
}

model AnalyticsQuery {
  id          String      @id @default(cuid())
  tenantId    String
  name        String
  description String?
  query       String      @db.Text
  type        QueryType   
  parameters  Json        @default("{}")
  schedule    String?     // Cron expression
  isActive    Boolean     @default(true)
  lastRun     DateTime?
  nextRun     DateTime?
  metadata    Json        @default("{}")
  createdBy   String
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  tenant      Tenant      @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  creator     User        @relation("QueryCreator", fields: [createdBy], references: [id])
  executions  QueryExecution[]

  @@unique([tenantId, name])
  @@index([tenantId, isActive])
  @@index([nextRun])
  @@map("analytics_queries")
}

model QueryExecution {
  id          String        @id @default(cuid())
  queryId     String
  status      ExecutionStatus @default(running)
  results     Json?
  resultCount Int?
  executionTime Float?
  startedAt   DateTime      @default(now())
  completedAt DateTime?
  error       String?
  metadata    Json          @default("{}")

  query       AnalyticsQuery @relation(fields: [queryId], references: [id], onDelete: Cascade)

  @@index([queryId, status])
  @@index([startedAt])
  @@map("query_executions")
}

model AnalyticsAlert {
  id          String       @id @default(cuid())
  tenantId    String
  name        String
  description String?
  metricId    String?
  condition   Json         // Alert condition
  threshold   Float?
  isActive    Boolean      @default(true)
  severity    AlertSeverity @default(medium)
  channels    Json         @default("[]") // Notification channels
  lastTriggered DateTime?
  triggerCount Int         @default(0)
  metadata    Json         @default("{}")
  createdBy   String
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  tenant      Tenant       @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  metric      AnalyticsMetric? @relation(fields: [metricId], references: [id], onDelete: SetNull)
  creator     User         @relation("AlertCreator", fields: [createdBy], references: [id])
  triggers    AlertTrigger[]

  @@unique([tenantId, name])
  @@index([tenantId, isActive])
  @@map("analytics_alerts")
}

model AlertTrigger {
  id          String       @id @default(cuid())
  alertId     String
  metricValue Float
  threshold   Float
  condition   String
  triggeredAt DateTime     @default(now())
  resolved    Boolean      @default(false)
  resolvedAt  DateTime?
  metadata    Json         @default("{}")

  alert       AnalyticsAlert @relation(fields: [alertId], references: [id], onDelete: Cascade)

  @@index([alertId, triggeredAt])
  @@index([triggeredAt, resolved])
  @@map("alert_triggers")
}

model DataCube {
  id          String    @id @default(cuid())
  tenantId    String
  name        String
  description String?
  schema      Json      // Cube schema definition
  dimensions  Json      @default("[]")
  measures    Json      @default("[]")
  filters     Json      @default("{}")
  isActive    Boolean   @default(true)
  lastBuilt   DateTime?
  metadata    Json      @default("{}")
  createdBy   String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  tenant      Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  creator     User      @relation("CubeCreator", fields: [createdBy], references: [id])

  @@unique([tenantId, name])
  @@index([tenantId, isActive])
  @@map("data_cubes")
}

model CohortAnalysis {
  id          String    @id @default(cuid())
  tenantId    String
  name        String
  description String?
  cohortType  CohortType
  dateColumn  String
  valueColumn String?
  groupBy     Json      @default("[]")
  filters     Json      @default("{}")
  periods     Int       @default(12)
  periodType  PeriodType @default(MONTH)
  results     Json?
  isActive    Boolean   @default(true)
  lastRun     DateTime?
  metadata    Json      @default("{}")
  createdBy   String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  tenant      Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  creator     User      @relation("CohortCreator", fields: [createdBy], references: [id])

  @@unique([tenantId, name])
  @@index([tenantId, cohortType])
  @@map("cohort_analyses")
}

model FunnelAnalysis {
  id          String    @id @default(cuid())
  tenantId    String
  name        String
  description String?
  steps       Json      // Funnel steps definition
  timeWindow  Int       @default(30) // days
  filters     Json      @default("{}")
  results     Json?
  conversionRate Float?
  isActive    Boolean   @default(true)
  lastRun     DateTime?
  metadata    Json      @default("{}")
  createdBy   String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  tenant      Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  creator     User      @relation("FunnelCreator", fields: [createdBy], references: [id])

  @@unique([tenantId, name])
  @@index([tenantId, isActive])
  @@map("funnel_analyses")
}

model RetentionAnalysis {
  id            String    @id @default(cuid())
  tenantId      String
  name          String
  description   String?
  entityType    String    // 'user', 'member', etc.
  startEvent    Json      // Initial event definition
  returnEvent   Json      // Return event definition
  timeWindows   Json      @default("[]") // Retention periods
  filters       Json      @default("{}")
  results       Json?
  retentionRate Float?
  isActive      Boolean   @default(true)
  lastRun       DateTime?
  metadata      Json      @default("{}")
  createdBy     String
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  tenant        Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  creator       User      @relation("RetentionCreator", fields: [createdBy], references: [id])

  @@unique([tenantId, name])
  @@index([tenantId, entityType])
  @@map("retention_analyses")
}

model SegmentAnalysis {
  id          String    @id @default(cuid())
  tenantId    String
  name        String
  description String?
  entityType  String
  criteria    Json      // Segmentation criteria
  metrics     Json      @default("[]")
  results     Json?
  segments    Json?
  isActive    Boolean   @default(true)
  lastRun     DateTime?
  metadata    Json      @default("{}")
  createdBy   String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  tenant      Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  creator     User      @relation("SegmentCreator", fields: [createdBy], references: [id])

  @@unique([tenantId, name])
  @@index([tenantId, entityType])
  @@map("segment_analyses")
}

model PerformanceMetric {
  id            String              @id @default(cuid())
  tenantId      String
  name          String
  type          PerformanceMetricType
  value         Float
  unit          String
  tags          Json                @default("{}")
  metadata      Json                @default("{}")
  timestamp     DateTime            @default(now())
  source        String
  environment   String              @default("production")

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  traces        PerformanceTrace[]

  @@index([tenantId, type, timestamp])
  @@index([tenantId, name, timestamp])
  @@map("performance_metrics")
}

model PerformanceTrace {
  id            String              @id @default(cuid())
  tenantId      String
  traceId       String
  spanId        String
  parentSpanId  String?
  operationName String
  startTime     DateTime
  endTime       DateTime
  duration      Float
  status        TraceStatus
  tags          Json                @default("{}")
  logs          Json                @default("[]")
  errors        Json                @default("[]")
  metricId      String?

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  metric        PerformanceMetric?  @relation(fields: [metricId], references: [id])

  @@index([tenantId, traceId])
  @@index([tenantId, operationName, startTime])
  @@map("performance_traces")
}

model PerformanceAlert {
  id            String              @id @default(cuid())
  tenantId      String
  name          String
  description   String?
  metricType    PerformanceMetricType
  condition     Json
  threshold     Float
  severity      AlertSeverity
  isActive      Boolean             @default(true)
  lastTriggered DateTime?
  config        Json                @default("{}")
  createdBy     String
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  creator       User                @relation(fields: [createdBy], references: [id])
  triggers      PerformanceAlertTrigger[]

  @@map("performance_alerts")
}

model PerformanceAlertTrigger {
  id            String              @id @default(cuid())
  tenantId      String
  alertId       String
  metricValue   Float
  threshold     Float
  severity      AlertSeverity
  message       String
  metadata      Json                @default("{}")
  resolvedAt    DateTime?
  createdAt     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  alert         PerformanceAlert    @relation(fields: [alertId], references: [id], onDelete: Cascade)

  @@map("performance_alert_triggers")
}

model SystemHealthCheck {
  id            String              @id @default(cuid())
  tenantId      String
  service       String
  endpoint      String
  status        HealthStatus
  responseTime  Float
  statusCode    Int?
  message       String?
  metadata      Json                @default("{}")
  checkedAt     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, service, checkedAt])
  @@map("system_health_checks")
}

model PerformanceProfile {
  id            String              @id @default(cuid())
  tenantId      String
  name          String
  type          ProfileType
  data          Json
  duration      Float
  metadata      Json                @default("{}")
  createdBy     String
  createdAt     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  creator       User                @relation(fields: [createdBy], references: [id])

  @@map("performance_profiles")
}

model ResourceUsage {
  id            String              @id @default(cuid())
  tenantId      String
  resourceType  ResourceType
  usage         Float
  limit         Float?
  unit          String
  metadata      Json                @default("{}")
  timestamp     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, resourceType, timestamp])
  @@map("resource_usage")
}

model PerformanceBenchmark {
  id            String              @id @default(cuid())
  tenantId      String
  name          String
  type          BenchmarkType
  config        Json                @default("{}")
  results       Json                @default("{}")
  baseline      Json?
  score         Float?
  passed        Boolean             @default(false)
  createdBy     String
  createdAt     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  creator       User                @relation(fields: [createdBy], references: [id])

  @@map("performance_benchmarks")
}

model Workflow {
  id            String              @id @default(cuid())
  tenantId      String
  name          String
  description   String?
  trigger       WorkflowTrigger
  triggerConfig Json                @default("{}")
  isActive      Boolean             @default(true)
  version       Int                 @default(1)
  tags          Json                @default("[]")
  metadata      Json                @default("{}")
  createdBy     String
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  creator       User                @relation(fields: [createdBy], references: [id])
  steps         WorkflowStep[]
  executions    WorkflowExecution[]
  schedules     WorkflowSchedule[]
  webhooks      WorkflowWebhook[]
  variables     WorkflowVariable[]
  logs          WorkflowLog[]

  @@index([tenantId, isActive])
  @@index([tenantId, trigger])
  @@map("workflows")
}

model WorkflowStep {
  id            String              @id @default(cuid())
  tenantId      String
  workflowId    String
  name          String
  type          WorkflowStepType
  action        WorkflowAction
  config        Json                @default("{}")
  position      Int
  condition     Json?               // Conditional logic
  retryConfig   Json?               // Retry configuration
  timeout       Int?                // Timeout in seconds
  isActive      Boolean             @default(true)
  dependencies  Json                @default("[]") // Step dependencies

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  workflow      Workflow            @relation(fields: [workflowId], references: [id], onDelete: Cascade)
  executions    WorkflowStepExecution[]

  @@index([tenantId, workflowId, position])
  @@map("workflow_steps")
}

model WorkflowExecution {
  id            String              @id @default(cuid())
  tenantId      String
  workflowId    String
  status        WorkflowExecutionStatus
  triggerData   Json                @default("{}")
  context       Json                @default("{}")
  startedAt     DateTime            @default(now())
  completedAt   DateTime?
  duration      Int?                // Duration in milliseconds
  error         String?
  metadata      Json                @default("{}")

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  workflow      Workflow            @relation(fields: [workflowId], references: [id], onDelete: Cascade)
  stepExecutions WorkflowStepExecution[]
  logs          WorkflowLog[]

  @@index([tenantId, workflowId, startedAt])
  @@index([tenantId, status])
  @@map("workflow_executions")
}

model WorkflowStepExecution {
  id            String              @id @default(cuid())
  tenantId      String
  executionId   String
  stepId        String
  status        WorkflowStepStatus
  input         Json                @default("{}")
  output        Json                @default("{}")
  startedAt     DateTime            @default(now())
  completedAt   DateTime?
  duration      Int?                // Duration in milliseconds
  attempts      Int                 @default(1)
  error         String?
  metadata      Json                @default("{}")

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  execution     WorkflowExecution   @relation(fields: [executionId], references: [id], onDelete: Cascade)
  step          WorkflowStep        @relation(fields: [stepId], references: [id], onDelete: Cascade)

  @@index([tenantId, executionId])
  @@index([tenantId, stepId])
  @@map("workflow_step_executions")
}

model WorkflowSchedule {
  id            String              @id @default(cuid())
  tenantId      String
  workflowId    String
  name          String
  cronExpression String
  timezone      String              @default("UTC")
  isActive      Boolean             @default(true)
  nextRunAt     DateTime?
  lastRunAt     DateTime?
  config        Json                @default("{}")
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  workflow      Workflow            @relation(fields: [workflowId], references: [id], onDelete: Cascade)

  @@index([tenantId, workflowId])
  @@index([nextRunAt])
  @@map("workflow_schedules")
}

model WorkflowTemplate {
  id            String              @id @default(cuid())
  tenantId      String?             // null for global templates
  name          String
  description   String?
  category      String
  template      Json                // Workflow template structure
  config        Json                @default("{}")
  isPublic      Boolean             @default(false)
  downloadCount Int                 @default(0)
  rating        Float?
  tags          Json                @default("[]")
  createdBy     String
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant?             @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  creator       User                @relation(fields: [createdBy], references: [id])

  @@index([tenantId, category])
  @@index([isPublic, category])
  @@map("workflow_templates")
}

model WorkflowWebhook {
  id            String              @id @default(cuid())
  tenantId      String
  workflowId    String
  url           String              @unique
  secret        String?
  isActive      Boolean             @default(true)
  config        Json                @default("{}")
  lastTriggered DateTime?
  createdAt     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  workflow      Workflow            @relation(fields: [workflowId], references: [id], onDelete: Cascade)

  @@index([tenantId, workflowId])
  @@map("workflow_webhooks")
}

model WorkflowVariable {
  id            String              @id @default(cuid())
  tenantId      String
  workflowId    String?             // null for global variables
  name          String
  value         String
  type          VariableType
  isSecret      Boolean             @default(false)
  description   String?
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  workflow      Workflow?           @relation(fields: [workflowId], references: [id], onDelete: Cascade)

  @@unique([tenantId, workflowId, name])
  @@index([tenantId, workflowId])
  @@map("workflow_variables")
}

model WorkflowLog {
  id            String              @id @default(cuid())
  tenantId      String
  workflowId    String
  executionId   String?
  level         LogLevel
  message       String
  data          Json?
  timestamp     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  workflow      Workflow            @relation(fields: [workflowId], references: [id], onDelete: Cascade)
  execution     WorkflowExecution?  @relation(fields: [executionId], references: [id], onDelete: Cascade)

  @@index([tenantId, workflowId, timestamp])
  @@index([tenantId, executionId])
  @@map("workflow_logs")
}

model SecurityPolicy {
  id            String              @id @default(cuid())
  tenantId      String
  name          String
  description   String?
  policyType    SecurityPolicyType
  rules         Json                @default("[]")
  isActive      Boolean             @default(true)
  severity      SecuritySeverity
  actions       Json                @default("[]")
  exemptions    Json                @default("[]")
  metadata      Json                @default("{}")
  createdBy     String
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  creator       User                @relation(fields: [createdBy], references: [id])
  violations    SecurityViolation[]

  @@index([tenantId, policyType])
  @@index([tenantId, isActive])
  @@map("security_policies")
}

model SecurityViolation {
  id            String              @id @default(cuid())
  tenantId      String
  policyId      String
  userId        String?
  violationType ViolationType
  severity      SecuritySeverity
  description   String
  details       Json                @default("{}")
  ipAddress     String?
  userAgent     String?
  endpoint      String?
  resolved      Boolean             @default(false)
  resolvedBy    String?
  resolvedAt    DateTime?
  actions       Json                @default("[]")
  metadata      Json                @default("{}")
  createdAt     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  policy        SecurityPolicy      @relation(fields: [policyId], references: [id], onDelete: Cascade)
  user          User?               @relation(fields: [userId], references: [id])
  resolver      User?               @relation("ViolationResolver", fields: [resolvedBy], references: [id])

  @@index([tenantId, severity])
  @@index([tenantId, resolved])
  @@index([tenantId, createdAt])
  @@map("security_violations")
}

model SecurityScan {
  id            String              @id @default(cuid())
  tenantId      String
  scanType      SecurityScanType
  target        String              // URL, IP, service name, etc.
  status        ScanStatus
  startedAt     DateTime            @default(now())
  completedAt   DateTime?
  duration      Int?                // Duration in milliseconds
  findings      Json                @default("[]")
  summary       Json                @default("{}")
  config        Json                @default("{}")
  scheduledBy   String?
  metadata      Json                @default("{}")

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  scheduler     User?               @relation("SecurityScanScheduler", fields: [scheduledBy], references: [id])

  @@index([tenantId, scanType])
  @@index([tenantId, status])
  @@index([tenantId, startedAt])
  @@map("security_scans")
}

model SecurityIncident {
  id            String              @id @default(cuid())
  tenantId      String
  title         String
  description   String
  incidentType  IncidentType
  severity      SecuritySeverity
  status        IncidentStatus
  assignedTo    String?
  reportedBy    String
  affectedUsers Json                @default("[]")
  affectedSystems Json              @default("[]")
  timeline      Json                @default("[]")
  evidence      Json                @default("[]")
  response      Json                @default("{}")
  resolution    String?
  lessons       String?
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt
  resolvedAt    DateTime?

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  assignee      User?               @relation("IncidentAssignee", fields: [assignedTo], references: [id])
  reporter      User                @relation("IncidentReporter", fields: [reportedBy], references: [id])

  @@index([tenantId, severity])
  @@index([tenantId, status])
  @@index([tenantId, createdAt])
  @@map("security_incidents")
}

model SecurityAlert {
  id            String              @id @default(cuid())
  tenantId      String
  alertType     AlertType
  title         String
  message       String
  severity      SecuritySeverity
  source        String              // System component that generated the alert
  metadata      Json                @default("{}")
  acknowledged  Boolean             @default(false)
  acknowledgedBy String?
  acknowledgedAt DateTime?
  resolved      Boolean             @default(false)
  resolvedBy    String?
  resolvedAt    DateTime?
  escalated     Boolean             @default(false)
  escalatedAt   DateTime?
  createdAt     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  acknowledger  User?               @relation("AlertAcknowledger", fields: [acknowledgedBy], references: [id])
  resolver      User?               @relation("AlertResolver", fields: [resolvedBy], references: [id])

  @@index([tenantId, severity])
  @@index([tenantId, acknowledged])
  @@index([tenantId, resolved])
  @@index([tenantId, createdAt])
  @@map("security_alerts")
}

model SecurityAuditLog {
  id            String              @id @default(cuid())
  tenantId      String
  userId        String?
  action        String
  resource      String
  resourceId    String?
  outcome       AuditOutcome
  details       Json                @default("{}")
  ipAddress     String?
  userAgent     String?
  sessionId     String?
  riskScore     Float?
  metadata      Json                @default("{}")
  timestamp     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user          User?               @relation("SecurityAuditUser", fields: [userId], references: [id])

  @@index([tenantId, action])
  @@index([tenantId, userId])
  @@index([tenantId, timestamp])
  @@index([tenantId, riskScore])
  @@map("security_audit_logs")
}

model ThreatIntelligence {
  id            String              @id @default(cuid())
  tenantId      String
  threatType    ThreatType
  source        String              // IP, domain, hash, etc.
  confidence    Float               // 0.0 to 1.0
  severity      SecuritySeverity
  description   String
  indicators    Json                @default("[]")
  references    Json                @default("[]")
  tags          Json                @default("[]")
  isActive      Boolean             @default(true)
  lastSeen      DateTime?
  firstSeen     DateTime            @default(now())
  metadata      Json                @default("{}")
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, threatType])
  @@index([tenantId, severity])
  @@index([tenantId, isActive])
  @@map("threat_intelligence")
}

model SecurityBaseline {
  id            String              @id @default(cuid())
  tenantId      String
  name          String
  description   String?
  framework     String              // CIS, NIST, ISO27001, etc.
  version       String
  controls      Json                @default("[]")
  compliance    Float               // Compliance percentage
  lastAssessed  DateTime?
  nextAssessment DateTime?
  findings      Json                @default("[]")
  remediation   Json                @default("[]")
  isActive      Boolean             @default(true)
  createdBy     String
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  creator       User                @relation("BaselineCreator", fields: [createdBy], references: [id])

  @@index([tenantId, framework])
  @@index([tenantId, compliance])
  @@map("security_baselines")
}

model SecurityConfiguration {
  id            String              @id @default(cuid())
  tenantId      String
  category      String              // authentication, encryption, access_control, etc.
  setting       String
  value         String
  isEnabled     Boolean             @default(true)
  riskLevel     SecuritySeverity?
  description   String?
  compliance    Json                @default("[]")
  lastModified  DateTime            @default(now())
  modifiedBy    String

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  modifier      User                @relation("ConfigModifier", fields: [modifiedBy], references: [id])

  @@unique([tenantId, category, setting])
  @@index([tenantId, category])
  @@map("security_configurations")
}

model Asset {
  id            String              @id @default(cuid())
  tenantId      String
  name          String
  type          AssetType
  category      String
  serialNumber  String?             
  purchaseDate  DateTime?
  purchasePrice Float?
  currentValue  Float?
  location      String?
  assignedTo    String?
  status        AssetStatus
  metadata      Json                @default("{}")
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  assignee      User?               @relation("AssetAssignee", fields: [assignedTo], references: [id])
  maintenance   AssetMaintenance[]

  @@index([tenantId, type])
  @@index([tenantId, status])
  @@map("assets")
}model AssetMaintenance {
  id            String              @id @default(cuid())
  tenantId      String
  assetId       String
  type          MaintenanceType
  scheduledDate DateTime
  completedDate DateTime?
  cost          Float?
  notes         String?
  performedBy   String?
  createdAt     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  asset         Asset               @relation(fields: [assetId], references: [id], onDelete: Cascade)
  technician    User?               @relation("MaintenanceTechnician", fields: [performedBy], references: [id])

  @@map("asset_maintenance")
}

model ComplianceFramework {
  id            String              @id @default(cuid())
  tenantId      String
  name          String
  version       String
  requirements  Json                @default("[]")
  isActive      Boolean             @default(true)
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  assessments   ComplianceAssessment[]

  @@map("compliance_frameworks")
}

model ComplianceAssessment {
  id            String              @id @default(cuid())
  tenantId      String
  frameworkId   String
  status        ComplianceStatus
  score         Float
  findings      Json                @default("[]")
  evidence      Json                @default("[]")
  assessedBy    String
  assessedAt    DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  framework     ComplianceFramework @relation(fields: [frameworkId], references: [id])
  assessor      User                @relation("ComplianceAssessor", fields: [assessedBy], references: [id])

  @@map("compliance_assessments")
}

model Resource {
  id            String              @id @default(cuid())
  tenantId      String
  name          String
  type          ResourcePlanType
  capacity      Float
  availability  Json                @default("{}")
  cost          Float?
  metadata      Json                @default("{}")
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  allocations   ResourceAllocation[]

  @@map("resources")
}

model ResourceAllocation {
  id            String              @id @default(cuid())
  tenantId      String
  resourceId    String
  projectId     String?
  quantity      Float
  startDate     DateTime
  endDate       DateTime?
  status        AllocationStatus
  createdBy     String
  createdAt     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  resource      Resource            @relation(fields: [resourceId], references: [id])
  creator       User                @relation("AllocationCreator", fields: [createdBy], references: [id])

  @@map("resource_allocations")
}

model KnowledgeArticle {
  id            String              @id @default(cuid())
  tenantId      String
  title         String
  content       String
  category      String
  tags          Json                @default("[]")
  views         Int                 @default(0)
  isPublished   Boolean             @default(false)
  authorId      String
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  author        User                @relation("ArticleAuthor", fields: [authorId], references: [id])
  feedback      ArticleFeedback[]

  @@map("knowledge_articles")
}

model ArticleFeedback {
  id            String              @id @default(cuid())
  tenantId      String
  articleId     String
  userId        String
  rating        Int
  comment       String?
  createdAt     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  article       KnowledgeArticle    @relation(fields: [articleId], references: [id], onDelete: Cascade)
  user          User                @relation("FeedbackUser", fields: [userId], references: [id])

  @@map("article_feedback")
}

model SupportTicket {
  id            String              @id @default(cuid())
  tenantId      String
  subject       String
  description   String
  priority      TicketPriority
  status        TicketStatus
  category      String
  assignedTo    String?
  customerId    String
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt
  resolvedAt    DateTime?

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  assignee      User?               @relation("TicketAssignee", fields: [assignedTo], references: [id])
  customer      User                @relation("TicketCustomer", fields: [customerId], references: [id])
  messages      TicketMessage[]

  @@map("support_tickets")
}

model TicketMessage {
  id            String              @id @default(cuid())
  tenantId      String
  ticketId      String
  senderId      String
  message       String
  attachments   Json                @default("[]")
  createdAt     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  ticket        SupportTicket       @relation(fields: [ticketId], references: [id], onDelete: Cascade)
  sender        User                @relation("MessageSender", fields: [senderId], references: [id])

  @@map("ticket_messages")
}

model SocialAccount {
  id            String              @id @default(cuid())
  tenantId      String
  platform      SocialPlatform
  accountId     String
  accessToken   String
  refreshToken  String?
  metadata      Json                @default("{}")
  isActive      Boolean             @default(true)
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  posts         SocialPost[]

  @@map("social_accounts")
}

model SocialPost {
  id            String              @id @default(cuid())
  tenantId      String
  accountId     String
  content       String
  mediaUrls     Json                @default("[]")
  scheduledAt   DateTime?
  publishedAt   DateTime?
  metrics       Json                @default("{}")
  status        PostStatus
  createdBy     String
  createdAt     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  account       SocialAccount       @relation(fields: [accountId], references: [id])
  creator       User                @relation("PostCreator", fields: [createdBy], references: [id])

  @@map("social_posts")
}

model MobileDevice {
  id            String              @id @default(cuid())
  tenantId      String
  userId        String
  deviceId      String              @unique
  platform      MobilePlatform
  model         String?
  osVersion     String?
  appVersion    String
  pushToken     String?
  isActive      Boolean             @default(true)
  lastSeen      DateTime            @default(now())
  createdAt     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user          User                @relation("UserDevices", fields: [userId], references: [id])
  sessions      MobileSession[]

  @@map("mobile_devices")
}

model MobileSession {
  id            String              @id @default(cuid())
  tenantId      String
  deviceId      String
  sessionToken  String              @unique
  startedAt     DateTime            @default(now())
  endedAt       DateTime?
  ipAddress     String?
  location      Json?

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  device        MobileDevice        @relation(fields: [deviceId], references: [id], onDelete: Cascade)

  @@map("mobile_sessions")
}

model IoTDevice {
  id            String              @id @default(cuid())
  tenantId      String
  deviceId      String              @unique
  name          String
  type          IoTDeviceType
  status        IoTDeviceStatus
  firmware      String?
  location      Json?
  config        Json                @default("{}")
  lastHeartbeat DateTime?
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  telemetry     IoTTelemetry[]

  @@map("iot_devices")
}

model IoTTelemetry {
  id            String              @id @default(cuid())
  tenantId      String
  deviceId      String
  metric        String
  value         Float
  unit          String?
  timestamp     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  device        IoTDevice           @relation(fields: [deviceId], references: [id], onDelete: Cascade)

  @@index([tenantId, deviceId, timestamp])
  @@map("iot_telemetry")
}

model BlockchainTransaction {
  id            String              @id @default(cuid())
  tenantId      String
  transactionHash String            @unique
  fromAddress   String
  toAddress     String
  amount        Float
  gasUsed       Float?
  blockNumber   Int?
  status        TransactionStatus
  metadata      Json                @default("{}")
  createdAt     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@map("blockchain_transactions")
}

model SmartContract {
  id            String              @id @default(cuid())
  tenantId      String
  address       String              @unique
  name          String
  abi           Json
  bytecode      String?
  network       String
  deployedBy    String
  deployedAt    DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  deployer      User                @relation("ContractDeployer", fields: [deployedBy], references: [id])

  @@map("smart_contracts")
}

model EdgeNode {
  id            String              @id @default(cuid())
  tenantId      String
  nodeId        String              @unique
  name          String
  location      Json
  capacity      Json                @default("{}")
  status        EdgeNodeStatus
  lastSync      DateTime?
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  workloads     EdgeWorkload[]

  @@map("edge_nodes")
}

model EdgeWorkload {
  id            String              @id @default(cuid())
  tenantId      String
  nodeId        String
  name          String
  type          WorkloadType
  config        Json                @default("{}")
  status        WorkloadStatus
  startedAt     DateTime            @default(now())
  completedAt   DateTime?

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  node          EdgeNode            @relation(fields: [nodeId], references: [id])

  @@map("edge_workloads")
}

model VideoContent {
  id            String              @id @default(cuid())
  tenantId      String
  title         String
  description   String?
  url           String
  thumbnailUrl  String?
  duration      Int                 // in seconds
  views         Int                 @default(0)
  isLive        Boolean             @default(false)
  streamKey     String?             @unique
  uploadedBy    String
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  uploader      User                @relation("VideoUploader", fields: [uploadedBy], references: [id])
  analytics     VideoAnalytics[]

  @@map("video_content")
}

model VideoAnalytics {
  id            String              @id @default(cuid())
  tenantId      String
  videoId       String
  userId        String?
  watchTime     Int                 // in seconds
  completionRate Float
  quality       String
  timestamp     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  video         VideoContent        @relation(fields: [videoId], references: [id], onDelete: Cascade)
  user          User?               @relation("VideoViewer", fields: [userId], references: [id])

  @@map("video_analytics")
}

model VirtualEvent {
  id            String              @id @default(cuid())
  tenantId      String
  name          String
  description   String
  startTime     DateTime
  endTime       DateTime
  platform      VirtualPlatform
  meetingUrl    String?
  capacity      Int
  isRecorded    Boolean             @default(false)
  hostId        String
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  host          User                @relation("EventHost", fields: [hostId], references: [id])
  attendees     VirtualAttendee[]

  @@map("virtual_events")
}

model VirtualAttendee {
  id            String              @id @default(cuid())
  tenantId      String
  eventId       String
  userId        String
  joinedAt      DateTime            @default(now())
  leftAt        DateTime?
  participated  Boolean             @default(false)

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  event         VirtualEvent        @relation(fields: [eventId], references: [id], onDelete: Cascade)
  user          User                @relation("EventAttendee", fields: [userId], references: [id])

  @@unique([eventId, userId])
  @@map("virtual_attendees")
}

model ARExperience {
  id            String              @id @default(cuid())
  tenantId      String
  name          String
  type          ARType
  markerUrl     String?
  modelUrl      String
  metadata      Json                @default("{}")
  isActive      Boolean             @default(true)
  createdBy     String
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  creator       User                @relation("ARCreator", fields: [createdBy], references: [id])
  interactions  ARInteraction[]

  @@map("ar_experiences")
}

model ARInteraction {
  id            String              @id @default(cuid())
  tenantId      String
  experienceId  String
  userId        String
  action        String
  duration      Int?                // in seconds
  metadata      Json                @default("{}")
  timestamp     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  experience    ARExperience        @relation(fields: [experienceId], references: [id], onDelete: Cascade)
  user          User                @relation("ARUser", fields: [userId], references: [id])

  @@map("ar_interactions")
}

model MLModel {
  id            String              @id @default(cuid())
  tenantId      String
  name          String
  type          MLModelType
  version       String
  accuracy      Float?
  framework     String              // tensorflow, pytorch, etc.
  modelUrl      String
  config        Json                @default("{}")
  isActive      Boolean             @default(true)
  createdBy     String
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  creator       User                @relation("MLCreator", fields: [createdBy], references: [id])
  predictions   MLPrediction[]
  trainingSessions MLTraining[]

  @@map("ml_models")
}

model MLPrediction {
  id            String              @id @default(cuid())
  tenantId      String
  modelId       String
  input         Json
  output        Json
  confidence    Float
  executionTime Int                 // in milliseconds
  timestamp     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  model         MLModel             @relation(fields: [modelId], references: [id], onDelete: Cascade)

  @@map("ml_predictions")
}

model MLTraining {
  id            String              @id @default(cuid())
  tenantId      String
  modelId       String
  datasetUrl    String
  epochs        Int
  batchSize     Int
  learningRate  Float
  loss          Float?
  status        TrainingStatus
  startedAt     DateTime            @default(now())
  completedAt   DateTime?

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  model         MLModel             @relation(fields: [modelId], references: [id], onDelete: Cascade)

  @@map("ml_training")
}

model DataLake {
  id            String              @id @default(cuid())
  tenantId      String
  name          String
  storage       String              // s3, azure, gcp
  bucket        String
  region        String
  sizeBytes     BigInt
  fileCount     Int
  isActive      Boolean             @default(true)
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  datasets      Dataset[]

  @@map("data_lakes")
}

model Dataset {
  id            String              @id @default(cuid())
  tenantId      String
  lakeId        String
  name          String
  format        DataFormat
  schema        Json
  sizeBytes     BigInt
  rowCount      Int?
  tags          Json                @default("[]")
  createdBy     String
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  lake          DataLake            @relation(fields: [lakeId], references: [id], onDelete: Cascade)
  creator       User                @relation("DatasetCreator", fields: [createdBy], references: [id])

  @@map("datasets")
}

model BusinessProcess {
  id            String              @id @default(cuid())
  tenantId      String
  name          String
  description   String?
  bpmnXml       String              // BPMN 2.0 XML
  version       Int                 @default(1)
  isActive      Boolean             @default(true)
  createdBy     String
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  creator       User                @relation("ProcessCreator", fields: [createdBy], references: [id])
  instances     ProcessInstance[]

  @@map("business_processes")
}

model ProcessInstance {
  id            String              @id @default(cuid())
  tenantId      String
  processId     String
  status        ProcessStatus
  variables     Json                @default("{}")
  currentTask   String?
  startedBy     String
  startedAt     DateTime            @default(now())
  completedAt   DateTime?

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  process       BusinessProcess     @relation(fields: [processId], references: [id], onDelete: Cascade)
  starter       User                @relation("ProcessStarter", fields: [startedBy], references: [id])
  tasks         ProcessTask[]

  @@map("process_instances")
}

model ProcessTask {
  id            String              @id @default(cuid())
  tenantId      String
  instanceId    String
  name          String
  type          TaskType
  assignedTo    String?
  status        TaskStatus
  dueDate       DateTime?
  completedAt   DateTime?
  formData      Json?

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  instance      ProcessInstance     @relation(fields: [instanceId], references: [id], onDelete: Cascade)
  assignee      User?               @relation("TaskAssignee", fields: [assignedTo], references: [id])

  @@map("process_tasks")
}

model Contract {
  id            String              @id @default(cuid())
  tenantId      String
  title         String
  contractNumber String             @unique
  type          ContractType
  value         Float?
  currency      String              @default("USD")
  startDate     DateTime
  endDate       DateTime
  status        ContractStatus
  parties       Json                @default("[]")
  documentUrl   String?
  createdBy     String
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  creator       User                @relation("ContractCreator", fields: [createdBy], references: [id])
  milestones    ContractMilestone[]
  amendments    ContractAmendment[]

  @@map("contracts")
}

model ContractMilestone {
  id            String              @id @default(cuid())
  tenantId      String
  contractId    String
  name          String
  dueDate       DateTime
  amount        Float?
  status        MilestoneStatus
  completedAt   DateTime?

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  contract      Contract            @relation(fields: [contractId], references: [id], onDelete: Cascade)

  @@map("contract_milestones")
}

model ContractAmendment {
  id            String              @id @default(cuid())
  tenantId      String
  contractId    String
  amendmentNumber String
  description   String
  effectiveDate DateTime
  documentUrl   String?
  createdBy     String
  createdAt     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  contract      Contract            @relation(fields: [contractId], references: [id], onDelete: Cascade)
  creator       User                @relation("AmendmentCreator", fields: [createdBy], references: [id])

  @@map("contract_amendments")
}

model Vendor {
  id            String              @id @default(cuid())
  tenantId      String
  name          String
  code          String              @unique
  category      String
  status        VendorStatus
  rating        Float?
  contactInfo   Json
  bankDetails   Json?
  taxId         String?
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  purchaseOrders PurchaseOrder[]
  evaluations   VendorEvaluation[]

  @@map("vendors")
}

model PurchaseOrder {
  id            String              @id @default(cuid())
  tenantId      String
  vendorId      String
  poNumber      String              @unique
  items         Json                @default("[]")
  totalAmount   Float
  currency      String              @default("USD")
  status        POStatus
  deliveryDate  DateTime?
  createdBy     String
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  vendor        Vendor              @relation(fields: [vendorId], references: [id])
  creator       User                @relation("POCreator", fields: [createdBy], references: [id])

  @@map("purchase_orders")
}

model VendorEvaluation {
  id            String              @id @default(cuid())
  tenantId      String
  vendorId      String
  period        String              // Q1 2024, etc.
  scores        Json                // quality, delivery, price, service
  overallScore  Float
  evaluatedBy   String
  evaluatedAt   DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  vendor        Vendor              @relation(fields: [vendorId], references: [id])
  evaluator     User                @relation("VendorEvaluator", fields: [evaluatedBy], references: [id])

  @@map("vendor_evaluations")
}

model Project {
  id            String              @id @default(cuid())
  tenantId      String
  name          String
  code          String              @unique
  description   String?
  startDate     DateTime
  endDate       DateTime
  budget        Float?
  status        ProjectStatus
  priority      Priority
  managerId     String
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  manager       User                @relation("ProjectManager", fields: [managerId], references: [id])
  tasks         ProjectTask[]
  team          ProjectTeam[]

  @@map("projects")
}

model ProjectTask {
  id            String              @id @default(cuid())
  tenantId      String
  projectId     String
  name          String
  description   String?
  startDate     DateTime
  dueDate       DateTime
  completedAt   DateTime?
  status        TaskStatus
  priority      Priority
  assignedTo    String?
  dependencies  Json                @default("[]")

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  project       Project             @relation(fields: [projectId], references: [id], onDelete: Cascade)
  assignee      User?               @relation("ProjectTaskAssignee", fields: [assignedTo], references: [id])

  @@map("project_tasks")
}

model ProjectTeam {
  id            String              @id @default(cuid())
  tenantId      String
  projectId     String
  userId        String
  role          String
  allocation    Float               // percentage
  startDate     DateTime
  endDate       DateTime?

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  project       Project             @relation(fields: [projectId], references: [id], onDelete: Cascade)
  user          User                @relation("ProjectTeamMember", fields: [userId], references: [id])

  @@unique([projectId, userId])
  @@map("project_team")
}

model TimeEntry {
  id            String              @id @default(cuid())
  tenantId      String
  userId        String
  projectId     String?
  taskId        String?
  description   String
  startTime     DateTime
  endTime       DateTime?
  duration      Int?                // in minutes
  billable      Boolean             @default(true)
  rate          Float?
  approvedBy    String?
  approvedAt    DateTime?

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user          User                @relation("TimeEntryUser", fields: [userId], references: [id])
  approver      User?               @relation("TimeEntryApprover", fields: [approvedBy], references: [id])

  @@index([tenantId, userId, startTime])
  @@map("time_entries")
}

model Timesheet {
  id            String              @id @default(cuid())
  tenantId      String
  userId        String
  periodStart   DateTime
  periodEnd     DateTime
  totalHours    Float
  billableHours Float
  status        TimesheetStatus
  submittedAt   DateTime?
  approvedBy    String?
  approvedAt    DateTime?

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user          User                @relation("TimesheetUser", fields: [userId], references: [id])
  approver      User?               @relation("TimesheetApprover", fields: [approvedBy], references: [id])

  @@unique([userId, periodStart, periodEnd])
  @@map("timesheets")
}

model CloudProvider {
  id            String              @id @default(cuid())
  tenantId      String
  name          String
  type          CloudProviderType
  region        String
  credentials   Json                // Encrypted
  config        Json                @default("{}")
  status        CloudStatus
  isDefault     Boolean             @default(false)
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  deployments   CloudDeployment[]
  resources     CloudResource[]

  @@map("cloud_providers")
}

model CloudDeployment {
  id            String              @id @default(cuid())
  tenantId      String
  providerId    String
  name          String
  type          DeploymentType
  config        Json
  status        DeploymentStatus
  resources     Json                @default("[]")
  cost          Float?
  deployedBy    String
  deployedAt    DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  provider      CloudProvider       @relation(fields: [providerId], references: [id])
  deployer      User                @relation("CloudDeployer", fields: [deployedBy], references: [id])

  @@map("cloud_deployments")
}

model CloudResource {
  id            String              @id @default(cuid())
  tenantId      String
  providerId    String
  resourceId    String              @unique
  type          String
  name          String
  status        ResourceStatus
  metadata      Json                @default("{}")
  cost          Float?
  createdAt     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  provider      CloudProvider       @relation(fields: [providerId], references: [id])

  @@map("cloud_resources")
}

model DisasterRecoveryPlan {
  id            String              @id @default(cuid())
  tenantId      String
  name          String
  rpo           Int                 // Recovery Point Objective (minutes)
  rto           Int                 // Recovery Time Objective (minutes)
  strategy      RecoveryStrategy
  resources     Json                @default("[]")
  procedures    Json                @default("[]")
  isActive      Boolean             @default(true)
  createdBy     String
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  creator       User                @relation("DRPlanCreator", fields: [createdBy], references: [id])
  backups       DisasterRecoveryBackup[]
  drills        DisasterRecoveryDrill[]

  @@map("disaster_recovery_plans")
}

model DisasterRecoveryBackup {
  id            String              @id @default(cuid())
  tenantId      String
  planId        String
  type          BackupType
  location      String
  size          BigInt
  status        BackupStatus
  metadata      Json                @default("{}")
  createdAt     DateTime            @default(now())
  expiresAt     DateTime?

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  plan          DisasterRecoveryPlan @relation(fields: [planId], references: [id])

  @@map("disaster_recovery_backups")
}

model DisasterRecoveryDrill {
  id            String              @id @default(cuid())
  tenantId      String
  planId        String
  type          DrillType
  status        DrillStatus
  results       Json                @default("{}")
  startedBy     String
  startedAt     DateTime            @default(now())
  completedAt   DateTime?

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  plan          DisasterRecoveryPlan @relation(fields: [planId], references: [id])
  initiator     User                @relation("DrillInitiator", fields: [startedBy], references: [id])

  @@map("disaster_recovery_drills")
}

model LoadBalancer {
  id            String              @id @default(cuid())
  tenantId      String
  name          String
  type          LoadBalancerType
  algorithm     LoadBalancerAlgorithm
  healthCheck   Json                @default("{}")
  targets       Json                @default("[]")
  status        LoadBalancerStatus
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  rules         LoadBalancerRule[]
  metrics       LoadBalancerMetric[]

  @@map("load_balancers")
}

model LoadBalancerRule {
  id            String              @id @default(cuid())
  tenantId      String
  balancerId    String
  priority      Int
  condition     Json
  action        Json
  isActive      Boolean             @default(true)
  createdAt     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  balancer      LoadBalancer        @relation(fields: [balancerId], references: [id])

  @@map("load_balancer_rules")
}

model LoadBalancerMetric {
  id            String              @id @default(cuid())
  tenantId      String
  balancerId    String
  requests      BigInt
  bytesIn       BigInt
  bytesOut      BigInt
  errors        Int
  latencyP50    Float
  latencyP95    Float
  latencyP99    Float
  timestamp     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  balancer      LoadBalancer        @relation(fields: [balancerId], references: [id])

  @@index([tenantId, balancerId, timestamp])
  @@map("load_balancer_metrics")
}

model CDNDistribution {
  id            String              @id @default(cuid())
  tenantId      String
  domain        String              @unique
  origin        String
  status        CDNStatus
  config        Json                @default("{}")
  locations     Json                @default("[]")
  cacheSettings Json                @default("{}")
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  metrics       CDNMetric[]

  @@map("cdn_distributions")
}

model CDNMetric {
  id            String              @id @default(cuid())
  tenantId      String
  distributionId String
  requests      BigInt
  hits          BigInt
  misses        BigInt
  bandwidth     BigInt
  errors        Int
  timestamp     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  distribution  CDNDistribution     @relation(fields: [distributionId], references: [id])

  @@index([tenantId, distributionId, timestamp])
  @@map("cdn_metrics")
}

model APIGateway {
  id            String              @id @default(cuid())
  tenantId      String
  name          String
  version       String
  basePath      String
  status        GatewayStatus
  config        Json                @default("{}")
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  routes        APIRoute[]
  policies      APIPolicy[]
  keys          APIKey[]

  @@map("api_gateways")
}

model APIRoute {
  id            String              @id @default(cuid())
  tenantId      String
  gatewayId     String
  path          String
  method        HttpMethod
  backend       String
  timeout       Int                 @default(30000)
  rateLimit     Json?
  auth          Json?
  isActive      Boolean             @default(true)
  createdAt     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  gateway       APIGateway          @relation(fields: [gatewayId], references: [id])

  @@unique([gatewayId, path, method])
  @@map("api_routes")
}

model APIPolicy {
  id            String              @id @default(cuid())
  tenantId      String
  gatewayId     String
  name          String
  type          PolicyType
  rules         Json
  priority      Int
  isActive      Boolean             @default(true)
  createdAt     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  gateway       APIGateway          @relation(fields: [gatewayId], references: [id])

  @@map("api_policies")
}

model APIKey {
  id            String              @id @default(cuid())
  tenantId      String
  gatewayId     String
  key           String              @unique
  name          String
  permissions   Json                @default("[]")
  rateLimit     Json?
  expiresAt     DateTime?
  isActive      Boolean             @default(true)
  createdAt     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  gateway       APIGateway          @relation(fields: [gatewayId], references: [id])
  usage         APIUsage[]

  @@map("api_keys")
}

model APIUsage {
  id            String              @id @default(cuid())
  tenantId      String
  keyId         String
  endpoint      String
  method        String
  statusCode    Int
  responseTime  Int
  timestamp     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  apiKey        APIKey              @relation(fields: [keyId], references: [id])

  @@index([tenantId, keyId, timestamp])
  @@map("api_usage")
}

model ServiceMesh {
  id            String              @id @default(cuid())
  tenantId      String
  name          String
  type          MeshType
  config        Json                @default("{}")
  status        MeshStatus
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  services      MeshService[]
  policies      MeshPolicy[]

  @@map("service_meshes")
}

model MeshService {
  id            String              @id @default(cuid())
  tenantId      String
  meshId        String
  name          String
  namespace     String
  version       String
  endpoints     Json                @default("[]")
  health        ServiceHealth
  metadata      Json                @default("{}")
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  mesh          ServiceMesh         @relation(fields: [meshId], references: [id])
  traffic       MeshTraffic[]

  @@map("mesh_services")
}

model MeshPolicy {
  id            String              @id @default(cuid())
  tenantId      String
  meshId        String
  name          String
  type          MeshPolicyType
  rules         Json
  targets       Json                @default("[]")
  isActive      Boolean             @default(true)
  createdAt     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  mesh          ServiceMesh         @relation(fields: [meshId], references: [id])

  @@map("mesh_policies")
}

model MeshTraffic {
  id            String              @id @default(cuid())
  tenantId      String
  serviceId     String
  source        String
  destination   String
  requests      BigInt
  errors        Int
  latencyP50    Float
  latencyP95    Float
  latencyP99    Float
  timestamp     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  service       MeshService         @relation(fields: [serviceId], references: [id])

  @@index([tenantId, serviceId, timestamp])
  @@map("mesh_traffic")
}

model ObservabilityDashboard {
  id            String              @id @default(cuid())
  tenantId      String
  name          String
  description   String?
  panels        Json                @default("[]")
  variables     Json                @default("[]")
  refresh       Int                 @default(60)
  createdBy     String
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  creator       User                @relation("ObsDashboardCreator", fields: [createdBy], references: [id])
  alerts        ObservabilityAlert[]

  @@map("observability_dashboards")
}

model ObservabilityMetric {
  id            String              @id @default(cuid())
  tenantId      String
  name          String
  type          MetricType
  value         Float
  tags          Json                @default("{}")
  timestamp     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, name, timestamp])
  @@map("observability_metrics")
}

model ObservabilityTrace {
  id            String              @id @default(cuid())
  tenantId      String
  traceId       String              @unique
  serviceName   String
  operationName String
  duration      Int
  tags          Json                @default("{}")
  logs          Json                @default("[]")
  status        TraceStatus
  timestamp     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  spans         ObservabilitySpan[]

  @@index([tenantId, serviceName, timestamp])
  @@map("observability_traces")
}

model ObservabilitySpan {
  id            String              @id @default(cuid())
  tenantId      String
  traceId       String
  spanId        String              @unique
  parentSpanId  String?
  operationName String
  serviceName   String
  duration      Int
  tags          Json                @default("{}")
  logs          Json                @default("[]")
  timestamp     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  trace         ObservabilityTrace  @relation(fields: [traceId], references: [id])

  @@map("observability_spans")
}

model ObservabilityLog {
  id            String              @id @default(cuid())
  tenantId      String
  level         LogLevel
  message       String
  service       String
  metadata      Json                @default("{}")
  timestamp     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, service, timestamp])
  @@index([tenantId, level, timestamp])
  @@map("observability_logs")
}

model ObservabilityAlert {
  id            String              @id @default(cuid())
  tenantId      String
  dashboardId   String?
  name          String
  condition     Json
  threshold     Float
  severity      AlertSeverity
  status        AlertStatus
  notifications Json                @default("[]")
  lastTriggered DateTime?
  createdAt     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  dashboard     ObservabilityDashboard? @relation(fields: [dashboardId], references: [id])

  @@map("observability_alerts")
}

model CostCenter {
  id            String              @id @default(cuid())
  tenantId      String
  name          String
  code          String              @unique
  budget        Float
  currency      String              @default("USD")
  ownerId       String
  metadata      Json                @default("{}")
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  owner         User                @relation("CostCenterOwner", fields: [ownerId], references: [id])
  allocations   CostAllocation[]
  budgets       CostBudget[]

  @@map("cost_centers")
}

model CostAllocation {
  id            String              @id @default(cuid())
  tenantId      String
  costCenterId  String
  resourceType  String
  resourceId    String
  amount        Float
  currency      String              @default("USD")
  period        DateTime
  tags          Json                @default("{}")
  createdAt     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  costCenter    CostCenter          @relation(fields: [costCenterId], references: [id])

  @@index([tenantId, costCenterId, period])
  @@map("cost_allocations")
}

model CostBudget {
  id            String              @id @default(cuid())
  tenantId      String
  costCenterId  String
  amount        Float
  period        BudgetPeriod
  alertThreshold Float              @default(80)
  status        BudgetStatus
  startDate     DateTime
  endDate       DateTime
  createdAt     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  costCenter    CostCenter          @relation(fields: [costCenterId], references: [id])
  alerts        CostAlert[]

  @@map("cost_budgets")
}

model CostAlert {
  id            String              @id @default(cuid())
  tenantId      String
  budgetId      String
  type          CostAlertType
  threshold     Float
  currentSpend  Float
  message       String
  status        AlertStatus
  createdAt     DateTime            @default(now())
  acknowledgedAt DateTime?

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  budget        CostBudget          @relation(fields: [budgetId], references: [id])

  @@map("cost_alerts")
}

model SoftwareLicense {
  id            String              @id @default(cuid())
  tenantId      String
  vendor        String
  product       String
  version       String?
  licenseKey    String?             // Encrypted
  type          LicenseType
  seats         Int?
  expiresAt     DateTime?
  cost          Float?
  status        LicenseStatus
  metadata      Json                @default("{}")
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  assignments   LicenseAssignment[]
  usage         LicenseUsage[]

  @@map("software_licenses")
}

model LicenseAssignment {
  id            String              @id @default(cuid())
  tenantId      String
  licenseId     String
  userId        String?
  deviceId      String?
  assignedAt    DateTime            @default(now())
  revokedAt     DateTime?
  status        AssignmentStatus

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  license       SoftwareLicense     @relation(fields: [licenseId], references: [id])
  user          User?               @relation("LicenseUser", fields: [userId], references: [id])

  @@map("license_assignments")
}

model LicenseUsage {
  id            String              @id @default(cuid())
  tenantId      String
  licenseId     String
  usedSeats     Int
  totalSeats    Int
  utilizationRate Float
  timestamp     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  license       SoftwareLicense     @relation(fields: [licenseId], references: [id])

  @@index([tenantId, licenseId, timestamp])
  @@map("license_usage")
}

model AuditReport {
  id            String              @id @default(cuid())
  tenantId      String
  type          AuditReportType
  period        Json                // {start: Date, end: Date}
  scope         Json                @default("[]")
  findings      Json                @default("[]")
  recommendations Json             @default("[]")
  status        ReportStatus
  generatedBy   String
  generatedAt   DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  generator     User                @relation("ReportGenerator", fields: [generatedBy], references: [id])
  evidence      AuditEvidence[]

  @@map("audit_reports")
}

model AuditEvidence {
  id            String              @id @default(cuid())
  tenantId      String
  reportId      String
  type          EvidenceType
  description   String
  data          Json
  source        String
  collectedAt   DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  report        AuditReport         @relation(fields: [reportId], references: [id])

  @@map("audit_evidence")
}

model ComplianceReport {
  id            String              @id @default(cuid())
  tenantId      String
  framework     String
  version       String
  assessmentDate DateTime
  score         Float
  status        ComplianceReportStatus
  gaps          Json                @default("[]")
  controls      Json                @default("[]")
  certifications Json              @default("[]")
  nextReview    DateTime?
  createdAt     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@map("compliance_reports")
}

model SSOProvider {
  id            String              @id @default(cuid())
  tenantId      String
  name          String
  type          SSOProviderType
  config        Json                // Encrypted config
  metadata      Json                @default("{}")
  isActive      Boolean             @default(true)
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  connections   SSOConnection[]
  sessions      SSOSession[]

  @@map("sso_providers")
}

model SSOConnection {
  id            String              @id @default(cuid())
  tenantId      String
  providerId    String
  domain        String
  config        Json                // Connection-specific config
  status        ConnectionStatus
  lastSync      DateTime?
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  provider      SSOProvider         @relation(fields: [providerId], references: [id])
  mappings      SSOUserMapping[]

  @@unique([tenantId, domain])
  @@map("sso_connections")
}

model SSOUserMapping {
  id            String              @id @default(cuid())
  tenantId      String
  connectionId  String
  externalId    String              // ID in external system
  userId        String
  attributes    Json                @default("{}")
  lastLogin     DateTime?
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  connection    SSOConnection       @relation(fields: [connectionId], references: [id])
  user          User                @relation("SSOUser", fields: [userId], references: [id])

  @@unique([connectionId, externalId])
  @@map("sso_user_mappings")
}

model SSOSession {
  id            String              @id @default(cuid())
  tenantId      String
  providerId    String
  userId        String
  sessionToken  String              @unique
  idToken       String?             // Encrypted
  refreshToken  String?             // Encrypted
  expiresAt     DateTime
  createdAt     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  provider      SSOProvider         @relation(fields: [providerId], references: [id])
  user          User                @relation("SSOSession", fields: [userId], references: [id])

  @@map("sso_sessions")
}

model QuantumCircuit {
  id            String              @id @default(cuid())
  tenantId      String
  name          String
  description   String?
  qubits        Int
  gates         Json                @default("[]")
  parameters    Json                @default("{}")
  createdBy     String
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  creator       User                @relation("QuantumCreator", fields: [createdBy], references: [id])
  jobs          QuantumJob[]
  results       QuantumResult[]

  @@map("quantum_circuits")
}

model QuantumJob {
  id            String              @id @default(cuid())
  tenantId      String
  circuitId     String
  backend       String              // IBM, Google, AWS Braket, etc.
  shots         Int                 @default(1024)
  status        QuantumJobStatus
  submittedBy   String
  submittedAt   DateTime            @default(now())
  completedAt   DateTime?

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  circuit       QuantumCircuit      @relation(fields: [circuitId], references: [id])
  submitter     User                @relation("QuantumSubmitter", fields: [submittedBy], references: [id])

  @@map("quantum_jobs")
}

model QuantumResult {
  id            String              @id @default(cuid())
  tenantId      String
  circuitId     String
  jobId         String?
  measurements  Json                // Quantum measurement results
  probabilities Json                // Probability distributions
  fidelity      Float?
  metadata      Json                @default("{}")
  createdAt     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  circuit       QuantumCircuit      @relation(fields: [circuitId], references: [id])

  @@map("quantum_results")
}

model Web3Wallet {
  id            String              @id @default(cuid())
  tenantId      String
  address       String              @unique
  chainId       Int
  network       String
  balance       String              // BigInt as string
  nonce         Int                 @default(0)
  privateKey    String?             // Encrypted, optional for external wallets
  isExternal    Boolean             @default(false)
  createdAt     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  transactions  Web3Transaction[]
  tokens        Web3Token[]
  nfts          Web3NFT[]

  @@map("web3_wallets")
}

model Web3Transaction {
  id            String              @id @default(cuid())
  tenantId      String
  walletId      String
  txHash        String              @unique
  fromAddress   String
  toAddress     String
  value         String              // BigInt as string
  gasPrice      String
  gasUsed       String
  status        Web3TxStatus
  blockNumber   BigInt?
  data          String?
  createdAt     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  wallet        Web3Wallet          @relation(fields: [walletId], references: [id])

  @@map("web3_transactions")
}

model Web3Token {
  id            String              @id @default(cuid())
  tenantId      String
  walletId      String
  contractAddress String
  symbol        String
  decimals      Int
  balance       String              // BigInt as string
  metadata      Json                @default("{}")
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  wallet        Web3Wallet          @relation(fields: [walletId], references: [id])

  @@unique([walletId, contractAddress])
  @@map("web3_tokens")
}

model Web3NFT {
  id            String              @id @default(cuid())
  tenantId      String
  walletId      String
  contractAddress String
  tokenId       String
  tokenUri      String?
  metadata      Json                @default("{}")
  createdAt     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  wallet        Web3Wallet          @relation(fields: [walletId], references: [id])

  @@unique([contractAddress, tokenId])
  @@map("web3_nfts")
}

model Web3SmartContract {
  id            String              @id @default(cuid())
  tenantId      String
  address       String              @unique
  name          String
  abi           Json
  bytecode      String?
  sourceCode    String?
  compiler      String?
  network       String
  deployedBy    String
  deployedAt    DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  deployer      User                @relation("Web3Deployer", fields: [deployedBy], references: [id])
  interactions  Web3ContractInteraction[]

  @@map("web3_smart_contracts")
}

model Web3ContractInteraction {
  id            String              @id @default(cuid())
  tenantId      String
  contractId    String
  method        String
  parameters    Json
  result        Json?
  txHash        String?
  calledBy      String
  calledAt      DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  contract      Web3SmartContract   @relation(fields: [contractId], references: [id])
  caller        User                @relation("Web3Caller", fields: [calledBy], references: [id])

  @@map("web3_contract_interactions")
}

model MetaverseWorld {
  id            String              @id @default(cuid())
  tenantId      String
  name          String
  platform      MetaversePlatform
  worldId       String              // Platform-specific world ID
  coordinates   Json                // 3D coordinates
  size          Json                // Dimensions
  capacity      Int
  isPublic      Boolean             @default(true)
  createdBy     String
  createdAt     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  creator       User                @relation("WorldCreator", fields: [createdBy], references: [id])
  avatars       MetaverseAvatar[]
  assets        MetaverseAsset[]
  events        MetaverseEvent[]

  @@map("metaverse_worlds")
}

model MetaverseAvatar {
  id            String              @id @default(cuid())
  tenantId      String
  worldId       String
  userId        String
  name          String
  modelUrl      String
  position      Json                // 3D position
  rotation      Json                // 3D rotation
  customization Json                @default("{}")
  status        AvatarStatus
  lastSeen      DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  world         MetaverseWorld      @relation(fields: [worldId], references: [id])
  user          User                @relation("MetaverseUser", fields: [userId], references: [id])
  interactions  MetaverseInteraction[]

  @@map("metaverse_avatars")
}

model MetaverseAsset {
  id            String              @id @default(cuid())
  tenantId      String
  worldId       String
  type          MetaAssetType
  name          String
  modelUrl      String
  position      Json                // 3D position
  scale         Json                // 3D scale
  properties    Json                @default("{}")
  isInteractive Boolean             @default(false)
  createdAt     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  world         MetaverseWorld      @relation(fields: [worldId], references: [id])

  @@map("metaverse_assets")
}

model MetaverseEvent {
  id            String              @id @default(cuid())
  tenantId      String
  worldId       String
  name          String
  description   String?
  startTime     DateTime
  endTime       DateTime
  maxAttendees  Int?
  isRecorded    Boolean             @default(false)
  createdBy     String
  createdAt     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  world         MetaverseWorld      @relation(fields: [worldId], references: [id])
  organizer     User                @relation("MetaEventOrganizer", fields: [createdBy], references: [id])

  @@map("metaverse_events")
}

model MetaverseInteraction {
  id            String              @id @default(cuid())
  tenantId      String
  avatarId      String
  type          InteractionType
  targetId      String?             // ID of target avatar or asset
  data          Json                @default("{}")
  timestamp     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  avatar        MetaverseAvatar     @relation(fields: [avatarId], references: [id])

  @@map("metaverse_interactions")
}

model CarbonFootprint {
  id            String              @id @default(cuid())
  tenantId      String
  period        DateTime
  scope1        Float               // Direct emissions
  scope2        Float               // Indirect emissions from energy
  scope3        Float               // Other indirect emissions
  total         Float
  unit          String              @default("tCO2e")
  calculatedBy  String
  calculatedAt  DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  calculator    User                @relation("CarbonCalculator", fields: [calculatedBy], references: [id])
  activities    CarbonActivity[]
  offsets       CarbonOffset[]

  @@map("carbon_footprints")
}

model CarbonActivity {
  id            String              @id @default(cuid())
  tenantId      String
  footprintId   String
  category      CarbonCategory
  activity      String
  quantity      Float
  unit          String
  emissionFactor Float
  emissions     Float
  metadata      Json                @default("{}")
  createdAt     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  footprint     CarbonFootprint     @relation(fields: [footprintId], references: [id])

  @@map("carbon_activities")
}

model CarbonOffset {
  id            String              @id @default(cuid())
  tenantId      String
  footprintId   String
  type          OffsetType
  provider      String
  amount        Float
  unit          String              @default("tCO2e")
  certificateId String?
  verificationUrl String?
  purchasedAt   DateTime            @default(now())
  expiresAt     DateTime?

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  footprint     CarbonFootprint     @relation(fields: [footprintId], references: [id])

  @@map("carbon_offsets")
}

model SustainabilityGoal {
  id            String              @id @default(cuid())
  tenantId      String
  name          String
  target        Float
  unit          String
  baseline      Float
  baselineYear  Int
  targetYear    Int
  category      GoalCategory
  status        GoalStatus
  createdBy     String
  createdAt     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  creator       User                @relation("GoalCreator", fields: [createdBy], references: [id])
  progress      SustainabilityProgress[]

  @@map("sustainability_goals")
}

model SustainabilityProgress {
  id            String              @id @default(cuid())
  tenantId      String
  goalId        String
  period        DateTime
  value         Float
  percentComplete Float
  notes         String?
  recordedAt    DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  goal          SustainabilityGoal  @relation(fields: [goalId], references: [id])

  @@map("sustainability_progress")
}

model AIGovernancePolicy {
  id            String              @id @default(cuid())
  tenantId      String
  name          String
  version       String
  scope         Json                @default("[]")
  principles    Json                @default("[]")
  requirements  Json                @default("[]")
  status        PolicyStatus
  approvedBy    String?
  approvedAt    DateTime?
  createdBy     String
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  creator       User                @relation("AIPolicyCreator", fields: [createdBy], references: [id])
  approver      User?               @relation("AIPolicyApprover", fields: [approvedBy], references: [id])
  reviews       AIModelReview[]
  audits        AIAudit[]

  @@map("ai_governance_policies")
}

model AIModelRegistry {
  id            String              @id @default(cuid())
  tenantId      String
  modelId       String              @unique
  name          String
  version       String
  type          AIModelType
  framework     String
  purpose       String
  riskLevel     RiskLevel
  metadata      Json                @default("{}")
  registeredBy  String
  registeredAt  DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  registrar     User                @relation("AIRegistrar", fields: [registeredBy], references: [id])
  reviews       AIModelReview[]
  monitoring    AIModelMonitoring[]

  @@map("ai_model_registry")
}

model AIModelReview {
  id            String              @id @default(cuid())
  tenantId      String
  modelId       String
  policyId      String
  reviewType    ReviewType
  status        ReviewStatus
  findings      Json                @default("[]")
  recommendations Json             @default("[]")
  score         Float?
  reviewedBy    String
  reviewedAt    DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  model         AIModelRegistry     @relation(fields: [modelId], references: [id])
  policy        AIGovernancePolicy  @relation(fields: [policyId], references: [id])
  reviewer      User                @relation("AIReviewer", fields: [reviewedBy], references: [id])

  @@map("ai_model_reviews")
}

model AIModelMonitoring {
  id            String              @id @default(cuid())
  tenantId      String
  modelId       String
  metric        String
  value         Float
  threshold     Float?
  status        MonitoringStatus
  timestamp     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  model         AIModelRegistry     @relation(fields: [modelId], references: [id])

  @@index([tenantId, modelId, timestamp])
  @@map("ai_model_monitoring")
}

model AIAudit {
  id            String              @id @default(cuid())
  tenantId      String
  policyId      String
  auditType     AIAuditType
  scope         Json                @default("[]")
  findings      Json                @default("[]")
  compliance    Float
  recommendations Json             @default("[]")
  auditedBy     String
  auditedAt     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  policy        AIGovernancePolicy  @relation(fields: [policyId], references: [id])
  auditor       User                @relation("AIAuditor", fields: [auditedBy], references: [id])

  @@map("ai_audits")
}

model AIEthicsBoard {
  id            String              @id @default(cuid())
  tenantId      String
  name          String
  charter       String
  members       Json                @default("[]")
  meetingSchedule Json              @default("{}")
  isActive      Boolean             @default(true)
  createdAt     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  decisions     AIEthicsDecision[]

  @@map("ai_ethics_boards")
}

model AIEthicsDecision {
  id            String              @id @default(cuid())
  tenantId      String
  boardId       String
  topic         String
  decision      String
  rationale     String
  votes         Json                @default("{}")
  impact        Json                @default("[]")
  decidedAt     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  board         AIEthicsBoard       @relation(fields: [boardId], references: [id])

  @@map("ai_ethics_decisions")
}

// ===== ENUMS =====

enum TicketStatus {
  VALID
  USED
  CANCELLED
  REFUNDED
  TRANSFERRED
}

enum SessionLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
  ALL_LEVELS
}

enum AttendeeStatus {
  REGISTERED
  CONFIRMED
  ATTENDED
  NO_SHOW
  CANCELLED
}

enum SponsorLevel {
  TITLE
  PLATINUM
  GOLD
  SILVER
  BRONZE
  SUPPORTER
}

enum ReminderType {
  EVENT_REMINDER
  RSVP_REMINDER
  FEEDBACK_REQUEST
  FOLLOW_UP
  CUSTOM
}

enum TenantStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
}

enum TenantPlan {
  STARTER
  PROFESSIONAL
  ENTERPRISE
  CUSTOM
}

enum UserRole {
  SUPER_ADMIN
  TENANT_ADMIN
  ADMIN
  MODERATOR
  MEMBER
}

enum UserStatus {
  ACTIVE
  INACTIVE
  PENDING
  SUSPENDED
}

enum OrgType {
  CAMP
  FESTIVAL
  COLLECTIVE
  COMMUNITY
  OTHER
}

enum PageStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum ContentBlockType {
  TEXT
  IMAGE
  VIDEO
  GALLERY
  FORM
  BUTTON
  HERO
  TESTIMONIAL
  FAQ
  PRICING
  TEAM
  CALENDAR
  MAP
  CUSTOM
}

enum EventType {
  GENERAL
  WORKSHOP
  SOCIAL
  ART_BUILD
  FUNDRAISER
  CULTURAL
  MEETING
  VOLUNTEER
  EDUCATIONAL
  ENTERTAINMENT
}

enum EventStatus {
  DRAFT
  PUBLISHED
  CANCELLED
  POSTPONED
  COMPLETED
}

enum RSVPStatus {
  PENDING
  CONFIRMED
  DECLINED
  WAITLIST
  CANCELLED
}

enum PaymentType {
  DONATION
  EVENT_TICKET
  SUBSCRIPTION
  MERCHANDISE
  OTHER
}

enum PaymentStatus {
  PENDING
  PROCESSING
  SUCCEEDED
  FAILED
  REFUNDED
  PARTIALLY_REFUNDED
  CANCELLED
}

enum DonationType {
  ONE_TIME
  RECURRING
  CAMPAIGN
}

enum DonationStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

enum BillingInterval {
  MONTHLY
  QUARTERLY
  YEARLY
}

enum SubscriptionStatus {
  ACTIVE
  PAST_DUE
  CANCELLED
  PAUSED
  TRIALING
  INCOMPLETE
}

enum NotificationType {
  MEMBER_APPLICATION
  MEMBER_APPROVED
  MEMBER_REJECTED
  EVENT_CREATED
  EVENT_UPDATED
  EVENT_CANCELLED
  EVENT_RSVP
  DONATION_RECEIVED
  PAYMENT_FAILED
  SYSTEM_ANNOUNCEMENT
  REMINDER
  WELCOME
  ADMIN_MESSAGE
}

enum NotificationChannel {
  IN_APP
  EMAIL
  SMS
  PUSH
}

enum BackupType {
  DATABASE
  FILES
  FULL
}

enum BackupStorageType {
  LOCAL
  S3
  AZURE
  GCP
}

enum BackupStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  FAILED
  EXPIRED
}

enum IntegrationCategory {
  EMAIL
  PAYMENT
  ANALYTICS
  SOCIAL
  STORAGE
  COMMUNICATION
  OTHER
}

enum AuditSeverity {
  INFO
  WARNING
  ERROR
  CRITICAL
}

enum NotificationPriority {
  LOW
  NORMAL
  HIGH
  URGENT
}

enum ApplicationStatus {
  PENDING
  UNDER_REVIEW
  APPROVED
  REJECTED
  WITHDRAWN
}

enum PointCategory {
  EVENT
  VOLUNTEER
  DONATION
  PARTICIPATION
  ACHIEVEMENT
  REFERRAL
  OTHER
}

enum ContentStatus {
  DRAFT
  REVIEW
  SCHEDULED
  PUBLISHED
  ARCHIVED
  DELETED
}

enum TranslationStatus {
  PENDING
  IN_PROGRESS
  REVIEW
  COMPLETED
}

enum CommentStatus {
  PENDING
  APPROVED
  REJECTED
  SPAM
}

enum ChannelType {
  TEXT
  VOICE
  VIDEO
  ANNOUNCEMENT
  PRIVATE
  PROJECT
  GENERAL
}

enum ChannelRole {
  OWNER
  ADMIN
  MODERATOR
  MEMBER
  GUEST
}

enum MessageContentType {
  TEXT
  MARKDOWN
  HTML
  IMAGE
  VIDEO
  AUDIO
  FILE
  LINK
  POLL
  EVENT
}

enum MentionType {
  USER
  CHANNEL
  ROLE
  EVERYONE
  HERE
}

enum InvitationStatus {
  PENDING
  ACCEPTED
  DECLINED
  EXPIRED
  REVOKED
}

enum AnnouncementPriority {
  LOW
  NORMAL
  HIGH
  URGENT
  CRITICAL
}

enum ModeratorRole {
  MODERATOR
  ADMIN
  SUPER_ADMIN
}

enum FacetType {
  TEXT
  NUMBER
  DATE
  BOOLEAN
  CATEGORY
  TAG
  RANGE
  LOCATION
}

enum Platform {
  IOS
  ANDROID
  WEB
  DESKTOP
}

enum DeliveryStatus {
  PENDING
  SENT
  DELIVERED
  FAILED
  CLICKED
  EXPIRED
}

enum NotificationFrequency {
  IMMEDIATE
  HOURLY
  DAILY
  WEEKLY
  NEVER
}

enum CampaignStatus {
  DRAFT
  SCHEDULED
  SENDING
  SENT
  PAUSED
  CANCELLED
  COMPLETED
}

enum ExportType {
  FULL
  INCREMENTAL
  FILTERED
  CUSTOM
}

enum ExportFormat {
  CSV
  JSON
  XLSX
  XML
  PDF
  SQL
}

enum ExportStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  CANCELLED
  EXPIRED
}

enum ImportType {
  CREATE
  UPDATE
  UPSERT
  DELETE
}

enum ImportFormat {
  CSV
  JSON
  XLSX
  XML
}

enum ImportStatus {
  PENDING
  VALIDATING
  PROCESSING
  COMPLETED
  FAILED
  CANCELLED
}

enum LogLevel {
  DEBUG
  INFO
  WARN
  ERROR
}

enum TemplateType {
  EXPORT
  IMPORT
}

enum SyncSourceType {
  DATABASE
  API
  FILE
  WEBHOOK
}

enum SyncTargetType {
  DATABASE
  API
  FILE
  EMAIL
}

enum SyncStatus {
  IDLE
  RUNNING
  ERROR
  DISABLED
}

enum SyncRunStatus {
  RUNNING
  COMPLETED
  FAILED
  CANCELLED
}

enum ModelType {
  CLASSIFICATION
  REGRESSION
  CLUSTERING
  RECOMMENDATION
  NLP
  COMPUTER_VISION
  TIME_SERIES
  ANOMALY_DETECTION
}

enum AIProvider {
  OPENAI
  ANTHROPIC
  HUGGING_FACE
  GOOGLE
  AWS
  AZURE
  CUSTOM
}

enum ModelStatus {
  TRAINING
  TRAINED
  DEPLOYED
  FAILED
  DEPRECATED
}

enum PredictionStatus {
  PENDING
  COMPLETED
  FAILED
}

enum TrainingStatus {
  RUNNING
  COMPLETED
  FAILED
  CANCELLED
}

enum InsightType {
  TREND
  ANOMALY
  PREDICTION
  RECOMMENDATION
  ALERT
  OPPORTUNITY
}

enum InsightPriority {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum RecommendationType {
  CONTENT_BASED
  COLLABORATIVE
  HYBRID
  POPULARITY
  TRENDING
}

enum MessageRole {
  USER
  ASSISTANT
  SYSTEM
}

enum AnalysisType {
  SENTIMENT
  EMOTION
  TOPIC
  LANGUAGE
  TOXICITY
  READABILITY
  KEYWORDS
  ENTITIES
}

enum AnalysisStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}

enum ExecutionStatus {
  RUNNING
  COMPLETED
  FAILED
  SKIPPED
}

enum WidgetType {
  LINE_CHART
  BAR_CHART
  PIE_CHART
  DONUT_CHART
  AREA_CHART
  SCATTER_PLOT
  HEATMAP
  TABLE
  METRIC
  GAUGE
  FUNNEL
  COHORT
  MAP
  TREEMAP
  SANKEY
  WATERFALL
}

enum MetricType {
  COUNT
  SUM
  AVG
  MIN
  MAX
  DISTINCT_COUNT
  RATIO
  PERCENTAGE
  GROWTH_RATE
  CUSTOM
}

enum QueryType {
  SQL
  AGGREGATION
  TIME_SERIES
  COHORT
  FUNNEL
  RETENTION
  SEGMENT
}

enum AlertSeverity {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum CohortType {
  ACQUISITION
  BEHAVIORAL
  REVENUE
}

enum PeriodType {
  DAY
  WEEK
  MONTH
  QUARTER
  YEAR
}

enum PerformanceMetricType {
  response_time
  throughput
  error_rate
  cpu_usage
  memory_usage
  disk_usage
  network_io
  database_query_time
  cache_hit_rate
  queue_size
  connection_pool_usage
  gc_time
  heap_usage
  thread_count
  custom
}

enum TraceStatus {
  ok
  error
  timeout
  cancelled
}

enum HealthStatus {
  healthy
  degraded
  unhealthy
  unknown
}

enum ProfileType {
  cpu
  memory
  heap
  flame_graph
  call_stack
  allocation
}

enum ResourceType {
  cpu
  memory
  disk
  network
  database_connections
  cache_memory
  queue_size
  thread_pool
  file_descriptors
  custom
}

enum BenchmarkType {
  load_test
  stress_test
  spike_test
  volume_test
  endurance_test
  scalability_test
  performance_regression
  custom
}

enum WorkflowTrigger {
  manual
  schedule
  webhook
  event
  api_call
  file_upload
  database_change
  email_received
  form_submission
  timer
  conditional
}

enum WorkflowStepType {
  action
  condition
  loop
  parallel
  delay
  approval
  notification
  integration
  custom
}

enum WorkflowAction {
  send_email
  send_notification
  create_record
  update_record
  delete_record
  call_api
  run_script
  generate_report
  process_file
  send_webhook
  create_user
  update_user
  assign_role
  trigger_workflow
  wait_for_approval
  calculate_value
  transform_data
  validate_data
  backup_data
  archive_data
  custom_function
}

enum WorkflowExecutionStatus {
  pending
  running
  completed
  failed
  cancelled
  paused
}

enum WorkflowStepStatus {
  pending
  running
  completed
  failed
  skipped
  retrying
}

enum VariableType {
  string
  number
  boolean
  json
  secret
  file
  reference
}

enum SecurityPolicyType {
  access_control
  data_protection
  authentication
  authorization
  encryption
  network_security
  compliance
  privacy
  incident_response
  vulnerability_management
  threat_detection
  custom
}

enum SecuritySeverity {
  low
  medium
  high
  critical
}

enum ViolationType {
  policy_violation
  access_denied
  suspicious_activity
  data_breach
  unauthorized_access
  privilege_escalation
  malware_detection
  network_intrusion
  compliance_violation
  custom
}

enum SecurityScanType {
  vulnerability_scan
  penetration_test
  compliance_audit
  code_analysis
  dependency_check
  network_scan
  web_app_scan
  infrastructure_scan
  custom
}

enum ScanStatus {
  queued
  running
  completed
  failed
  cancelled
}

enum IncidentType {
  data_breach
  malware_infection
  unauthorized_access
  denial_of_service
  phishing_attack
  insider_threat
  system_compromise
  compliance_violation
  privacy_violation
  other
}

enum IncidentStatus {
  reported
  investigating
  contained
  eradicated
  recovered
  closed
}

enum AlertType {
  intrusion_detection
  malware_detection
  anomaly_detection
  policy_violation
  system_failure
  compliance_alert
  threat_intelligence
  custom
}

enum AuditOutcome {
  success
  failure
  denied
  warning
  error
}

enum ThreatType {
  malware
  phishing
  botnet
  c2_server
  malicious_ip
  suspicious_domain
  vulnerability
  exploit
  indicator
  custom
}

enum AssetType {
  hardware
  software
  license
  equipment
  vehicle
  property
  other
}

enum AssetStatus {
  available
  assigned
  maintenance
  retired
  lost
}

enum MaintenanceType {
  preventive
  corrective
  predictive
  emergency
}

enum ComplianceStatus {
  compliant
  non_compliant
  partial
  pending
}

enum ResourcePlanType {
  human
  equipment
  material
  facility
  budget
}

enum AllocationStatus {
  planned
  active
  completed
  cancelled
}

enum TicketPriority {
  low
  medium
  high
  urgent
}

enum SocialPlatform {
  facebook
  twitter
  instagram
  linkedin
  youtube
  tiktok
}

enum PostStatus {
  draft
  scheduled
  published
  failed
}

enum MobilePlatform {
  ios
  android
  web
}

enum IoTDeviceType {
  sensor
  actuator
  gateway
  edge_device
}

enum IoTDeviceStatus {
  online
  offline
  error
  maintenance
}

enum TransactionStatus {
  pending
  confirmed
  failed
}

enum EdgeNodeStatus {
  online
  offline
  syncing
  error
}

enum WorkloadType {
  compute
  storage
  analytics
  ml_inference
}

enum WorkloadStatus {
  queued
  running
  completed
  failed
}// ===== STEPS 56-65: ADVANCED FEATURES & ANALYTICS =====

enum VirtualPlatform {
  zoom
  teams
  meet
  webex
  custom
}

enum ARType {
  marker_based
  markerless
  location_based
}

enum MLModelType {
  classification
  regression
  clustering
  nlp
  computer_vision
  time_series
}

enum DataFormat {
  csv
  json
  parquet
  avro
  orc
}

enum ProcessStatus {
  running
  completed
  failed
  cancelled
  suspended
}

enum TaskType {
  user_task
  service_task
  script_task
  send_task
  receive_task
}

enum TaskStatus {
  pending
  assigned
  in_progress
  completed
  cancelled
}

enum ContractType {
  service
  purchase
  lease
  employment
  nda
  partnership
}

enum ContractStatus {
  draft
  active
  expired
  terminated
  renewed
}

enum MilestoneStatus {
  pending
  completed
  overdue
}

enum VendorStatus {
  active
  inactive
  blacklisted
  pending_approval
}

enum POStatus {
  draft
  approved
  sent
  partial_delivery
  delivered
  closed
}

enum ProjectStatus {
  planning
  active
  on_hold
  completed
  cancelled
}

enum Priority {
  low
  medium
  high
  critical
}

enum TimesheetStatus {
  draft
  submitted
  approved
  rejected
}// Schema for Steps 66-75 - Enterprise & Scale Features

enum CloudProviderType {
  aws
  azure
  gcp
  alibaba
  oracle
  ibm
  digitalocean
  linode
}

enum CloudStatus {
  active
  inactive
  configuring
  error
}

enum DeploymentType {
  compute
  storage
  database
  network
  container
  serverless
}

enum DeploymentStatus {
  pending
  deploying
  active
  failed
  terminated
}

enum ResourceStatus {
  provisioning
  running
  stopped
  terminated
  error
}

enum RecoveryStrategy {
  backup_restore
  pilot_light
  warm_standby
  multi_site
}

enum DrillType {
  tabletop
  partial
  full
  surprise
}

enum DrillStatus {
  planned
  running
  completed
  failed
  cancelled
}

enum LoadBalancerType {
  application
  network
  classic
  global
}

enum LoadBalancerAlgorithm {
  round_robin
  least_connections
  ip_hash
  weighted
  random
}

enum LoadBalancerStatus {
  provisioning
  active
  updating
  deleting
  error
}

enum CDNStatus {
  deploying
  active
  updating
  disabled
  error
}

enum GatewayStatus {
  active
  inactive
  deploying
  updating
  error
}

enum HttpMethod {
  GET
  POST
  PUT
  DELETE
  PATCH
  HEAD
  OPTIONS
}

enum PolicyType {
  rate_limit
  auth
  cors
  transform
  cache
  circuit_breaker
}

enum MeshType {
  istio
  linkerd
  consul
  kuma
  traefik
}

enum MeshStatus {
  initializing
  active
  updating
  degraded
  error
}

enum ServiceHealth {
  healthy
  degraded
  unhealthy
  unknown
}

enum MeshPolicyType {
  traffic
  security
  observability
  resilience
}

enum AlertStatus {
  active
  acknowledged
  resolved
  suppressed
}

enum BudgetPeriod {
  monthly
  quarterly
  yearly
  custom
}

enum BudgetStatus {
  active
  exceeded
  warning
  inactive
}

enum CostAlertType {
  threshold
  forecast
  anomaly
  trend
}

enum LicenseType {
  perpetual
  subscription
  concurrent
  named_user
  site
  trial
}

enum LicenseStatus {
  active
  expired
  suspended
  revoked
}

enum AssignmentStatus {
  active
  revoked
  pending
  expired
}

enum AuditReportType {
  security
  compliance
  financial
  operational
  access
}

enum ReportStatus {
  draft
  reviewing
  final
  archived
}

enum EvidenceType {
  log
  screenshot
  document
  config
  metric
}

enum ComplianceReportStatus {
  compliant
  partial
  non_compliant
  pending_review
}

enum SSOProviderType {
  saml
  oidc
  oauth2
  ldap
  active_directory
}

enum ConnectionStatus {
  connected
  disconnected
  error
  syncing
}// Schema for Steps 76-80 - Innovation & Future Features

enum QuantumJobStatus {
  queued
  running
  completed
  failed
  cancelled
}

enum Web3TxStatus {
  pending
  confirmed
  failed
  dropped
}

enum MetaversePlatform {
  decentraland
  sandbox
  horizonworlds
  roblox
  fortnite
  vrchat
  spatial
  custom
}

enum AvatarStatus {
  online
  idle
  offline
}

enum MetaAssetType {
  building
  furniture
  vehicle
  decoration
  interactive
  nft
}

enum InteractionType {
  chat
  gesture
  trade
  collaborate
  play
}

enum CarbonCategory {
  energy
  transport
  waste
  water
  supply_chain
  travel
  digital
}

enum OffsetType {
  renewable_energy
  reforestation
  carbon_capture
  verified_credits
}

enum GoalCategory {
  emissions
  energy
  waste
  water
  biodiversity
  social
}

enum GoalStatus {
  on_track
  at_risk
  behind
  achieved
}

enum PolicyStatus {
  draft
  review
  approved
  active
  archived
}

enum AIModelType {
  classification
  regression
  nlp
  computer_vision
  reinforcement
  generative
  hybrid
}

enum RiskLevel {
  low
  medium
  high
  critical
}

enum ReviewType {
  fairness
  transparency
  privacy
  security
  performance
  compliance
}

enum ReviewStatus {
  pending
  in_progress
  completed
  escalated
}

enum MonitoringStatus {
  normal
  warning
  alert
  critical
}

enum AIAuditType {
  compliance
  ethics
  technical
  operational
}

// ===== STEPS 56-65: MISSING MODELS =====
// ===== STEPS 56-65: ADVANCED FEATURES & ANALYTICS =====

// Step 56: Video Streaming Platform
model VideoContent {
  id            String              @id @default(cuid())
  tenantId      String
  title         String
  description   String?
  url           String
  thumbnailUrl  String?
  duration      Int                 // in seconds
  views         Int                 @default(0)
  isLive        Boolean             @default(false)
  streamKey     String?             @unique
  uploadedBy    String
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  uploader      User                @relation("VideoUploader", fields: [uploadedBy], references: [id])
  analytics     VideoAnalytics[]

  @@map("video_content")
}

model VideoAnalytics {
  id            String              @id @default(cuid())
  tenantId      String
  videoId       String
  userId        String?
  watchTime     Int                 // in seconds
  completionRate Float
  quality       String
  timestamp     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  video         VideoContent        @relation(fields: [videoId], references: [id], onDelete: Cascade)
  user          User?               @relation("VideoViewer", fields: [userId], references: [id])

  @@map("video_analytics")
}

// Step 57: Virtual Event System
model VirtualEvent {
  id            String              @id @default(cuid())
  tenantId      String
  name          String
  description   String
  startTime     DateTime
  endTime       DateTime
  platform      VirtualPlatform
  meetingUrl    String?
  capacity      Int
  isRecorded    Boolean             @default(false)
  hostId        String
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  host          User                @relation("EventHost", fields: [hostId], references: [id])
  attendees     VirtualAttendee[]

  @@map("virtual_events")
}

model VirtualAttendee {
  id            String              @id @default(cuid())
  tenantId      String
  eventId       String
  userId        String
  joinedAt      DateTime            @default(now())
  leftAt        DateTime?
  participated  Boolean             @default(false)

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  event         VirtualEvent        @relation(fields: [eventId], references: [id], onDelete: Cascade)
  user          User                @relation("EventAttendee", fields: [userId], references: [id])

  @@unique([eventId, userId])
  @@map("virtual_attendees")
}

// Step 58: Augmented Reality Features
model ARExperience {
  id            String              @id @default(cuid())
  tenantId      String
  name          String
  type          ARType
  markerUrl     String?
  modelUrl      String
  metadata      Json                @default("{}")
  isActive      Boolean             @default(true)
  createdBy     String
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  creator       User                @relation("ARCreator", fields: [createdBy], references: [id])
  interactions  ARInteraction[]

  @@map("ar_experiences")
}

model ARInteraction {
  id            String              @id @default(cuid())
  tenantId      String
  experienceId  String
  userId        String
  action        String
  duration      Int?                // in seconds
  metadata      Json                @default("{}")
  timestamp     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  experience    ARExperience        @relation(fields: [experienceId], references: [id], onDelete: Cascade)
  user          User                @relation("ARUser", fields: [userId], references: [id])

  @@map("ar_interactions")
}

// Step 59: Machine Learning Pipeline
model MLModel {
  id            String              @id @default(cuid())
  tenantId      String
  name          String
  type          MLModelType
  version       String
  accuracy      Float?
  framework     String              // tensorflow, pytorch, etc.
  modelUrl      String
  config        Json                @default("{}")
  isActive      Boolean             @default(true)
  createdBy     String
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  creator       User                @relation("MLCreator", fields: [createdBy], references: [id])
  predictions   MLPrediction[]
  trainingSessions MLTraining[]

  @@map("ml_models")
}

model MLPrediction {
  id            String              @id @default(cuid())
  tenantId      String
  modelId       String
  input         Json
  output        Json
  confidence    Float
  executionTime Int                 // in milliseconds
  timestamp     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  model         MLModel             @relation(fields: [modelId], references: [id], onDelete: Cascade)

  @@map("ml_predictions")
}

model MLTraining {
  id            String              @id @default(cuid())
  tenantId      String
  modelId       String
  datasetUrl    String
  epochs        Int
  batchSize     Int
  learningRate  Float
  loss          Float?
  status        TrainingStatus
  startedAt     DateTime            @default(now())
  completedAt   DateTime?

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  model         MLModel             @relation(fields: [modelId], references: [id], onDelete: Cascade)

  @@map("ml_training")
}

// Step 60: Data Lake Architecture
model DataLake {
  id            String              @id @default(cuid())
  tenantId      String
  name          String
  storage       String              // s3, azure, gcp
  bucket        String
  region        String
  sizeBytes     BigInt
  fileCount     Int
  isActive      Boolean             @default(true)
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  datasets      Dataset[]

  @@map("data_lakes")
}

model Dataset {
  id            String              @id @default(cuid())
  tenantId      String
  lakeId        String
  name          String
  format        DataFormat
  schema        Json
  sizeBytes     BigInt
  rowCount      Int?
  tags          Json                @default("[]")
  createdBy     String
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  lake          DataLake            @relation(fields: [lakeId], references: [id], onDelete: Cascade)
  creator       User                @relation("DatasetCreator", fields: [createdBy], references: [id])

  @@map("datasets")
}

// Step 61: Business Process Management
model BusinessProcess {
  id            String              @id @default(cuid())
  tenantId      String
  name          String
  description   String?
  bpmnXml       String              // BPMN 2.0 XML
  version       Int                 @default(1)
  isActive      Boolean             @default(true)
  createdBy     String
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  creator       User                @relation("ProcessCreator", fields: [createdBy], references: [id])
  instances     ProcessInstance[]

  @@map("business_processes")
}

model ProcessInstance {
  id            String              @id @default(cuid())
  tenantId      String
  processId     String
  status        ProcessStatus
  variables     Json                @default("{}")
  currentTask   String?
  startedBy     String
  startedAt     DateTime            @default(now())
  completedAt   DateTime?

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  process       BusinessProcess     @relation(fields: [processId], references: [id], onDelete: Cascade)
  starter       User                @relation("ProcessStarter", fields: [startedBy], references: [id])
  tasks         ProcessTask[]

  @@map("process_instances")
}

model ProcessTask {
  id            String              @id @default(cuid())
  tenantId      String
  instanceId    String
  name          String
  type          TaskType
  assignedTo    String?
  status        TaskStatus
  dueDate       DateTime?
  completedAt   DateTime?
  formData      Json?

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  instance      ProcessInstance     @relation(fields: [instanceId], references: [id], onDelete: Cascade)
  assignee      User?               @relation("TaskAssignee", fields: [assignedTo], references: [id])

  @@map("process_tasks")
}

// Step 62: Contract Management
model Contract {
  id            String              @id @default(cuid())
  tenantId      String
  title         String
  contractNumber String             @unique
  type          ContractType
  value         Float?
  currency      String              @default("USD")
  startDate     DateTime
  endDate       DateTime
  status        ContractStatus
  parties       Json                @default("[]")
  documentUrl   String?
  createdBy     String
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  creator       User                @relation("ContractCreator", fields: [createdBy], references: [id])
  milestones    ContractMilestone[]
  amendments    ContractAmendment[]

  @@map("contracts")
}

model ContractMilestone {
  id            String              @id @default(cuid())
  tenantId      String
  contractId    String
  name          String
  dueDate       DateTime
  amount        Float?
  status        MilestoneStatus
  completedAt   DateTime?

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  contract      Contract            @relation(fields: [contractId], references: [id], onDelete: Cascade)

  @@map("contract_milestones")
}

model ContractAmendment {
  id            String              @id @default(cuid())
  tenantId      String
  contractId    String
  amendmentNumber String
  description   String
  effectiveDate DateTime
  documentUrl   String?
  createdBy     String
  createdAt     DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  contract      Contract            @relation(fields: [contractId], references: [id], onDelete: Cascade)
  creator       User                @relation("AmendmentCreator", fields: [createdBy], references: [id])

  @@map("contract_amendments")
}

// Step 63: Vendor Management
model Vendor {
  id            String              @id @default(cuid())
  tenantId      String
  name          String
  code          String              @unique
  category      String
  status        VendorStatus
  rating        Float?
  contactInfo   Json
  bankDetails   Json?
  taxId         String?
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  purchaseOrders PurchaseOrder[]
  evaluations   VendorEvaluation[]

  @@map("vendors")
}

model PurchaseOrder {
  id            String              @id @default(cuid())
  tenantId      String
  vendorId      String
  poNumber      String              @unique
  items         Json                @default("[]")
  totalAmount   Float
  currency      String              @default("USD")
  status        POStatus
  deliveryDate  DateTime?
  createdBy     String
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  vendor        Vendor              @relation(fields: [vendorId], references: [id])
  creator       User                @relation("POCreator", fields: [createdBy], references: [id])

  @@map("purchase_orders")
}

model VendorEvaluation {
  id            String              @id @default(cuid())
  tenantId      String
  vendorId      String
  period        String              // Q1 2024, etc.
  scores        Json                // quality, delivery, price, service
  overallScore  Float
  evaluatedBy   String
  evaluatedAt   DateTime            @default(now())

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  vendor        Vendor              @relation(fields: [vendorId], references: [id])
  evaluator     User                @relation("VendorEvaluator", fields: [evaluatedBy], references: [id])

  @@map("vendor_evaluations")
}

// Step 64: Project Management
model Project {
  id            String              @id @default(cuid())
  tenantId      String
  name          String
  code          String              @unique
  description   String?
  startDate     DateTime
  endDate       DateTime
  budget        Float?
  status        ProjectStatus
  priority      Priority
  managerId     String
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  manager       User                @relation("ProjectManager", fields: [managerId], references: [id])
  tasks         ProjectTask[]
  team          ProjectTeam[]

  @@map("projects")
}

model ProjectTask {
  id            String              @id @default(cuid())
  tenantId      String
  projectId     String
  name          String
  description   String?
  startDate     DateTime
  dueDate       DateTime
  completedAt   DateTime?
  status        TaskStatus
  priority      Priority
  assignedTo    String?
  dependencies  Json                @default("[]")

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  project       Project             @relation(fields: [projectId], references: [id], onDelete: Cascade)
  assignee      User?               @relation("ProjectTaskAssignee", fields: [assignedTo], references: [id])

  @@map("project_tasks")
}

model ProjectTeam {
  id            String              @id @default(cuid())
  tenantId      String
  projectId     String
  userId        String
  role          String
  allocation    Float               // percentage
  startDate     DateTime
  endDate       DateTime?

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  project       Project             @relation(fields: [projectId], references: [id], onDelete: Cascade)
  user          User                @relation("ProjectTeamMember", fields: [userId], references: [id])

  @@unique([projectId, userId])
  @@map("project_team")
}

// Step 65: Time Tracking
model TimeEntry {
  id            String              @id @default(cuid())
  tenantId      String
  userId        String
  projectId     String?
  taskId        String?
  description   String
  startTime     DateTime
  endTime       DateTime?
  duration      Int?                // in minutes
  billable      Boolean             @default(true)
  rate          Float?
  approvedBy    String?
  approvedAt    DateTime?

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user          User                @relation("TimeEntryUser", fields: [userId], references: [id])
  approver      User?               @relation("TimeEntryApprover", fields: [approvedBy], references: [id])

  @@index([tenantId, userId, startTime])
  @@map("time_entries")
}

model Timesheet {
  id            String              @id @default(cuid())
  tenantId      String
  userId        String
  periodStart   DateTime
  periodEnd     DateTime
  totalHours    Float
  billableHours Float
  status        TimesheetStatus
  submittedAt   DateTime?
  approvedBy    String?
  approvedAt    DateTime?

  tenant        Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user          User                @relation("TimesheetUser", fields: [userId], references: [id])
  approver      User?               @relation("TimesheetApprover", fields: [approvedBy], references: [id])

  @@unique([userId, periodStart, periodEnd])
  @@map("timesheets")
}

// New Enums for Steps 56-65
enum VirtualPlatform {
  zoom
  teams
  meet
  webex
  custom
}

enum ARType {
  marker_based
  markerless
  location_based
}

enum MLModelType {
  classification
  regression
  clustering
  nlp
  computer_vision
  time_series
}

enum TrainingStatus {
  pending
  running
  completed
  failed
}

enum DataFormat {
  csv
  json
  parquet
  avro
  orc
}

enum ProcessStatus {
  running
  completed
  failed
  cancelled
  suspended
}

enum TaskType {
  user_task
  service_task
  script_task
  send_task
  receive_task
}

enum TaskStatus {
  pending
  assigned
  in_progress
  completed
  cancelled
}

enum ContractType {
  service
  purchase
  lease
  employment
  nda
  partnership
}

enum ContractStatus {
  draft
  active
  expired
  terminated
  renewed
}

enum MilestoneStatus {
  pending
  completed
  overdue
}

enum VendorStatus {
  active
  inactive
  blacklisted
  pending_approval
}

enum POStatus {
  draft
  approved
  sent
  partial_delivery
  delivered
  closed
}

enum ProjectStatus {
  planning
  active
  on_hold
  completed
  cancelled
}

enum Priority {
  low
  medium
  high
  critical
}

enum TimesheetStatus {
  draft
  submitted
  approved
  rejected
}